/**
 * Do not edit by hand.
 * Auto-generated from docs/victorialogs/logsql.md (## Pipes)
 * Committed on purpose for build stability (no-gen environments). Regenerate via `npm run gen:logsql-pipes`.
 * Source: scripts/extract-pipes.ts
 */

export type PipeEntry = {
  id: string; // slug from title (must end with pipe)
  title: string;  // H3 text without '#'
  description: string; // HTML from the Markdown body
  value: string; // function name to insert after "|"
};
export const pipes: PipeEntry[] = [
  {
    "id": "block-stats-pipe",
    "value": "block_stats",
    "title": "block_stats pipe",
    "description": "<div class='vm-markdown'><p><code>&lt;q&gt; | block_stats</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> returns the following stats for each field in every data block\nprocessed by <code>&lt;q&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a>:</p>\n<ul>\n<li><code>field</code> - <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">field</a> name</li>\n<li><code>rows</code> - the number of rows at the given <code>field</code></li>\n<li><code>type</code> - internal storage type for the given <code>field</code></li>\n<li><code>values_bytes</code> - on-disk size of the data for the given <code>field</code></li>\n<li><code>bloom_bytes</code> - on-disk size of bloom filter data for the given <code>field</code></li>\n<li><code>dict_bytes</code> - on-disk size of the dictionary data for the given <code>field</code></li>\n<li><code>dict_items</code> - the number of unique values in the dictionary for the given <code>field</code></li>\n<li><code>_stream</code> - the <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#stream-fields\">log stream</a> for the given <code>field</code></li>\n<li><code>part_path</code> - the path to the data part where the field data is stored</li>\n</ul>\n<p>The <code>block_stats</code> pipe is needed mostly for debugging purposes.\nSee, for example, <a href=\"https://docs.victoriametrics.com/victorialogs/faq/#how-to-determine-which-log-fields-occupy-the-most-of-disk-space\">how to detect which log field occupies the most of the disk space</a>,\nor <a href=\"https://docs.victoriametrics.com/victorialogs/faq/#how-to-determine-which-log-streams-occupy-the-most-of-disk-space\">how to detect which log stream occupies the most of the disk space</a>.</p>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query_stats-pipe\"><code>query_stats</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#value_type-filter\"><code>value_type</code> filter</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#blocks_count-pipe\"><code>blocks_count</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#len-pipe\"><code>len</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "blocks-count-pipe",
    "value": "blocks_count",
    "title": "blocks_count pipe",
    "description": "<div class='vm-markdown'><p><code>&lt;q&gt; | blocks_count</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> counts the number of blocks with logs processed by <code>&lt;q&gt;</code>. This pipe is needed mostly for debugging.</p>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query_stats-pipe\"><code>query_stats</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#block_stats-pipe\"><code>block_stats</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#len-pipe\"><code>len</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "collapse-nums-pipe",
    "value": "collapse_nums",
    "title": "collapse_nums pipe",
    "description": "<div class='vm-markdown'><p><code>&lt;q&gt; | collapse_nums at &lt;field&gt;</code> pipe replaces all the decimal and hexadecimal numbers at the given <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\"><code>&lt;field&gt;</code></a>\nreturned by the <code>&lt;q&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a> with <code>&lt;N&gt;</code> placeholder.\nFor example, if the <code>_msg</code> field contains <code>2024-10-20T12:34:56Z request duration 1.34s</code>, then it is replaced with <code>&lt;N&gt;-&lt;N&gt;-&lt;N&gt;T&lt;N&gt;:&lt;N&gt;:&lt;N&gt;Z request duration &lt;N&gt;.&lt;N&gt;s</code> by the following query:</p>\n<pre><code class=\"language-logsql\">_time:5m | collapse_nums at _msg\n</code></pre>\n<p>The <code>at ...</code> suffix can be omitted if <code>collapse_nums</code> is applied to <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\"><code>_msg</code></a> field.\nThe following query is equivalent to the previous one:</p>\n<pre><code class=\"language-logsql\">_time:5m | collapse_nums\n</code></pre>\n<p>This functionality is useful for locating the most frequently seen log patterns across log messages with various decimal and hexadecimal numbers.\nThis includes the following entities: timestamps, IP addresses, request durations, response sizes, <a href=\"https://en.wikipedia.org/wiki/Universally_unique_identifier\">UUIDs</a>, trace IDs, user IDs, etc.\nLog messages with such entities become identical after applying <code>collapse_nums</code> pipe to them, so the <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#top-pipe\"><code>top</code> pipe</a> can be applied to them in order to get the most frequently\nseen patterns across log messages. For example, the following query returns top 5 the most frequently seen log patterns across log messages for the last hour:</p>\n<pre><code class=\"language-logsql\">_time:1h | collapse_nums | top 5 by (_msg)\n</code></pre>\n<p><code>collapse_nums</code> can detect certain patterns in the collapsed numbers and replace them with the corresponding placeholders if <code>prettify</code> suffix is added to the <code>collapse_nums</code> pipe:</p>\n<ul>\n<li><code>&lt;N&gt;-&lt;N&gt;-&lt;N&gt;-&lt;N&gt;-&lt;N&gt;</code> is replaced with <code>&lt;UUID&gt;</code> placeholder.</li>\n<li><code>&lt;N&gt;.&lt;N&gt;.&lt;N&gt;.&lt;N&gt;</code> is replaced with <code>&lt;IP4&gt;</code> placeholder.</li>\n<li><code>&lt;N&gt;:&lt;N&gt;:&lt;N&gt;</code> is replaced with <code>&lt;TIME&gt;</code> placeholder. Optional fractional seconds after the time are treated as a part of <code>&lt;TIME&gt;</code>.</li>\n<li><code>&lt;N&gt;-&lt;N&gt;-&lt;N&gt;</code> and <code>&lt;N&gt;/&lt;N&gt;/&lt;N&gt;</code> is replaced with <code>&lt;DATE&gt;</code> placeholder.</li>\n<li><code>&lt;N&gt;-&lt;N&gt;-&lt;N&gt;T&lt;N&gt;:&lt;N&gt;:&lt;N&gt;</code> and <code>&lt;N&gt;-&lt;N&gt;-&lt;N&gt; &lt;N&gt;:&lt;N&gt;:&lt;N&gt;</code> is replaced with <code>&lt;DATETIME&gt;</code> placeholder. Optional timezone after the datetime is treated as a part of <code>&lt;DATETIME&gt;</code>.</li>\n</ul>\n<p>For example, the <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\">log message</a>\n<code>2edfed59-3e98-4073-bbb2-28d321ca71a7 - [2024/12/08 15:21:02] 10.71.20.32 GET /foo 200</code> is replaced with <code>&lt;UUID&gt; - [&lt;DATETIME&gt;] &lt;IP4&gt; GET /foo &lt;N&gt;</code>\nwhen the following query is executed:</p>\n<pre><code class=\"language-logsql\">_time:1h | collapse_nums prettify\n</code></pre>\n<p>The patterns returned by <code>collapse_nums prettify</code> pipe can be used in <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pattern-match-filter\">pattern match filter</a>.</p>\n<p><code>collapse_nums</code> can miss some numbers or can collapse unexpected numbers. In this case <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#conditional-collapse_nums\">conditional <code>collapse_nums</code></a> can be used\nfor skipping such values and pre-processing them separately with <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#replace_regexp-pipe\"><code>replace_regexp</code></a>.</p>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#conditional-collapse_nums\">conditional <code>collapse_nums</code></a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pattern-match-filter\">pattern match filter</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#replace-pipe\"><code>replace</code></a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#replace_regexp-pipe\"><code>replace_regexp</code></a></li>\n</ul>\n</div>"
  },
  {
    "id": "copy-pipe",
    "value": "copy",
    "title": "copy pipe",
    "description": "<div class='vm-markdown'><p>If some <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">log fields</a> must be copied, then <code>| copy src1 as dst1, ..., srcN as dstN</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> can be used.\nFor example, the following query copies <code>host</code> field to <code>server</code> for logs over the last 5 minutes, so the output contains both <code>host</code> and <code>server</code> fields:</p>\n<pre><code class=\"language-logsql\">_time:5m | copy host as server\n</code></pre>\n<p>Multiple fields can be copied with a single <code>| copy ...</code> pipe. For example, the following query copies\n<a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#time-field\"><code>_time</code> field</a> to <code>timestamp</code>, while <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\"><code>_msg</code> field</a>\nis copied to <code>message</code>:</p>\n<pre><code class=\"language-logsql\">_time:5m | copy _time as timestamp, _msg as message\n</code></pre>\n<p>The <code>as</code> keyword is optional.</p>\n<p><code>cp</code> keyword can be used instead of <code>copy</code> for convenience. For example, <code>_time:5m | cp foo bar</code> is equivalent to <code>_time:5m | copy foo as bar</code>.</p>\n<p>It is possible to copy multiple fields with identical prefix to fields with another prefix. For example, the following query copies\nall the fields with the prefix <code>foo</code> to fields with the prefix <code>bar</code>:</p>\n<pre><code class=\"language-logsql\">_time:5m | copy foo* as bar*\n</code></pre>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#rename-pipe\"><code>rename</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#fields-pipe\"><code>fields</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#delete-pipe\"><code>delete</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "decolorize-pipe",
    "value": "decolorize",
    "title": "decolorize pipe",
    "description": "<div class='vm-markdown'><p><code>&lt;q&gt; | decolorize &lt;field&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> drops <a href=\"https://en.wikipedia.org/wiki/ANSI_escape_code\">ANSI color codes</a>\nfrom the given <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\"><code>&lt;field&gt;</code></a> across all the logs returned by <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\"><code>&lt;q&gt;</code> query</a>.</p>\n<p>The <code>&lt;field&gt;</code> may be omitted if ANSI color codes must be dropped from the <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\"><code>_msg</code> field</a>.\nFor example, the following query drops ANSI color codes from all the <code>_msg</code> fields over the logs for the last 5 minutes:</p>\n<pre><code class=\"language-logsql\">_time:5m | decolorize\n</code></pre>\n<p>This query is equivalent to the following query:</p>\n<pre><code class=\"language-logsql\">_time:5m | decolorize _msg\n</code></pre>\n<p>It is recommended to drop ANSI color codes at the data ingestion stage according to <a href=\"https://docs.victoriametrics.com/victorialogs/data-ingestion/#decolorizing\">these docs</a>.\nThis simplifies further querying of the logs without the need to apply <code>| decolorize</code> pipe to them.</p>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#replace-pipe\"><code>replace</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#replace_regexp-pipe\"><code>replace_regexp</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "delete-pipe",
    "value": "delete",
    "title": "delete pipe",
    "description": "<div class='vm-markdown'><p>If some <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">log fields</a> must be deleted, then <code>| delete field1, ..., fieldN</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> can be used.\nFor example, the following query deletes <code>host</code> and <code>app</code> fields from the logs over the last 5 minutes:</p>\n<pre><code class=\"language-logsql\">_time:5m | delete host, app\n</code></pre>\n<p><code>drop</code>, <code>del</code> and <code>rm</code> keywords can be used instead of <code>delete</code> for convenience. For example, <code>_time:5m | drop host</code> is equivalent to <code>_time:5m | delete host</code>.</p>\n<p>It is possible to delete fields with common prefix. For example, the following query deletes all the fields with <code>foo</code> prefix:</p>\n<pre><code class=\"language-logsql\">_time:5m | delete foo*\n</code></pre>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#rename-pipe\"><code>rename</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#fields-pipe\"><code>fields</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "drop-empty-fields-pipe",
    "value": "drop_empty_fields",
    "title": "drop_empty_fields pipe",
    "description": "<div class='vm-markdown'><p><code>&lt;q&gt; | drop_empty_fields</code> pipe drops <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">fields</a> with empty values from results returned by <code>&lt;q&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a>.\nIt also skips log entries with zero non-empty fields.</p>\n<p>For example, the following query drops possible empty <code>email</code> field generated by <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#extract-pipe\"><code>extract</code> pipe</a> if the <code>foo</code> field doesn&#39;t contain email:</p>\n<pre><code class=\"language-logsql\">_time:5m | extract &#39;email: &lt;email&gt;,&#39; from foo | drop_empty_fields\n</code></pre>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#filter-pipe\"><code>filter</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#extract-pipe\"><code>extract</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "extract-pipe",
    "value": "extract",
    "title": "extract pipe",
    "description": "<div class='vm-markdown'><p><code>&lt;q&gt; | extract &quot;pattern&quot; from field_name</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> extracts text into output fields according to the <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#format-for-extract-pipe-pattern\"><code>pattern</code></a> from the given\n<a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\"><code>field_name</code></a> returned by <code>&lt;q&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a>.\nExisting log fields remain unchanged after the <code>| extract ...</code> pipe.</p>\n<p><code>extract</code> pipe can be useful for extracting additional fields needed for further data processing with other pipes such as <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#stats-pipe\"><code>stats</code> pipe</a> or <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#sort-pipe\"><code>sort</code> pipe</a>.</p>\n<p>For example, the following query selects logs with the <code>error</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#word\">word</a> for the last day,\nextracts IP address from <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\"><code>_msg</code> field</a> into <code>ip</code> field and then calculates top 10 IP addresses\nwith the biggest number of logs using <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#top-pipe\"><code>top</code> pipe</a>:</p>\n<pre><code class=\"language-logsql\">_time:1d error | extract &quot;ip=&lt;ip&gt; &quot; from _msg | top 10 (ip)\n</code></pre>\n<p>It is expected that <code>_msg</code> field contains <code>ip=...</code> substring ending with space. For example, <code>error ip=1.2.3.4 from user_id=42</code>.\nIf there is no such substring in the current <code>_msg</code> field, then the <code>ip</code> output field will be empty.</p>\n<p>If the <code>extract</code> pipe is applied to <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\"><code>_msg</code> field</a>, then the <code>from _msg</code> part can be omitted.\nFor example, the following query is equivalent to the previous one:</p>\n<pre><code class=\"language-logsql\">_time:1d error | extract &quot;ip=&lt;ip&gt; &quot; | top 10 (ip)\n</code></pre>\n<p>If the <code>pattern</code> contains double quotes, then either put <code>\\</code> in front of double quotes or put the <code>pattern</code> inside single quotes.\nFor example, the following query extracts <code>ip</code> from the corresponding JSON field:</p>\n<pre><code class=\"language-logsql\">_time:5m | extract &#39;&quot;ip&quot;:&quot;&lt;ip&gt;&quot;&#39;\n</code></pre>\n<p>Add <code>keep_original_fields</code> to the end of <code>extract ...</code> when the original non-empty values of the fields mentioned in the pattern must be preserved\ninstead of overwriting them with the extracted values. For example, the following query extracts <code>&lt;ip&gt;</code> only if the original value for <code>ip</code> field is missing or is empty:</p>\n<pre><code class=\"language-logsql\">_time:5m | extract &#39;ip=&lt;ip&gt; &#39; keep_original_fields\n</code></pre>\n<p>By default <code>extract</code> writes empty matching fields to the output, which may overwrite existing values. Add <code>skip_empty_results</code> to the end of <code>extract ...</code>\nin order to prevent overwriting the existing values for the corresponding fields with empty values.\nFor example, the following query preserves the original <code>ip</code> field value if the <code>foo</code> field doesn&#39;t contain the matching IP:</p>\n<pre><code class=\"language-logsql\">_time:5m | extract &#39;ip=&lt;ip&gt; &#39; from foo skip_empty_results\n</code></pre>\n<p>Performance tip: it is recommended using more specific <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#filters\">log filters</a> in order to reduce the number of log entries, which are passed to <code>extract</code>.\nSee <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#performance-tips\">general performance tips</a> for details.</p>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#format-for-extract-pipe-pattern\">Format for extract pipe pattern</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#conditional-extract\">Conditional extract</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#extract_regexp-pipe\"><code>extract_regexp</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#unpack_json-pipe\"><code>unpack_json</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#unpack_logfmt-pipe\"><code>unpack_logfmt</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#split-pipe\"><code>split</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#math-pipe\"><code>math</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "extract-regexp-pipe",
    "value": "extract_regexp",
    "title": "extract_regexp pipe",
    "description": "<div class='vm-markdown'><p><code>&lt;q&gt; | extract_regexp &quot;pattern&quot; from field_name</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> extracts substrings from the <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\"><code>field_name</code> field</a>\nreturned from <code>&lt;q&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a> according to the provided <code>pattern</code>, and stores them into field names according to the named fields inside the <code>pattern</code>.\nThe <code>pattern</code> must contain <a href=\"https://github.com/google/re2/wiki/Syntax\">RE2 regular expression</a> with named fields (aka capturing groups) in the form <code>(?P&lt;capture_field_name&gt;...)</code>.\nMatching substrings are stored to the given <code>capture_field_name</code> <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">log fields</a>.\nFor example, the following query extracts ipv4 addresses from <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\"><code>_msg</code> field</a>\nand puts them into <code>ip</code> field for logs over the last 5 minutes:</p>\n<pre><code class=\"language-logsql\">_time:5m | extract_regexp &quot;(?P&lt;ip&gt;([0-9]+[.]){3}[0-9]+)&quot; from _msg\n</code></pre>\n<p>The <code>from _msg</code> part can be omitted if the data extraction is performed from the <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\"><code>_msg</code> field</a>.\nSo the following query is equivalent to the previous one:</p>\n<pre><code class=\"language-logsql\">_time:5m | extract_regexp &quot;(?P&lt;ip&gt;([0-9]+[.]){3}[0-9]+)&quot;\n</code></pre>\n<p>Add <code>keep_original_fields</code> to the end of <code>extract_regexp ...</code> when the original non-empty values of the fields mentioned in the pattern must be preserved\ninstead of overwriting it with the extracted values. For example, the following query extracts <code>&lt;ip&gt;</code> only if the original value for <code>ip</code> field is missing or is empty:</p>\n<pre><code class=\"language-logsql\">_time:5m | extract_regexp &#39;ip=(?P&lt;ip&gt;([0-9]+[.]){3}[0-9]+)&#39; keep_original_fields\n</code></pre>\n<p>By default <code>extract_regexp</code> writes empty matching fields to the output, which may overwrite existing values. Add <code>skip_empty_results</code> to the end of <code>extract_regexp ...</code>\nin order to prevent overwriting the existing values for the corresponding fields with empty values.\nFor example, the following query preserves the original <code>ip</code> field value if the <code>foo</code> field doesn&#39;t contain the matching IP:</p>\n<pre><code class=\"language-logsql\">_time:5m | extract_regexp &#39;ip=(?P&lt;ip&gt;([0-9]+[.]){3}[0-9]+)&#39; from foo skip_empty_results\n</code></pre>\n<p>Performance tip: it is recommended using <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#extract-pipe\"><code>extract</code> pipe</a> instead of <code>extract_regexp</code> for achieving higher query performance.</p>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#conditional-extract_regexp\">Conditional <code>extract_regexp</code></a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#extract-pipe\"><code>extract</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#replace_regexp-pipe\"><code>replace_regexp</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#unpack_json-pipe\"><code>unpack_json</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "facets-pipe",
    "value": "facets",
    "title": "facets pipe",
    "description": "<div class='vm-markdown'><p><code>&lt;q&gt; | facets</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> returns the most frequent values for every seen <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">log field</a>\nreturned by <code>&lt;q&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a>. It also returns an estimated number of hits for every returned <code>field=value</code> pair.</p>\n<p>For example, the following query returns the most frequent values for every seen log field across logs with the <code>error</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#word\">word</a> over the last hour:</p>\n<pre><code class=\"language-logsql\">_time:1h error | facets\n</code></pre>\n<p>It is possible to specify the number of most frequently seen values to return for each log field by using the <code>facets N</code> syntax. For example,\nthe following query returns up to 3 most frequently seen values for each field across logs with the <code>error</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#word\">word</a> over the last hour:</p>\n<pre><code class=\"language-logsql\">_time:1h error | facets 3\n</code></pre>\n<p>By default <code>facets</code> pipe doesn&#39;t return log fields with too many unique values, since this may require a lot of additional memory to track.\nThe limit can be changed during the query via <code>max_values_per_field M</code> suffix. For example, the following query returns up to 15 most frequently seen\nfield values across fields with up to 100000 unique values:</p>\n<pre><code class=\"language-logsql\">_time:1h error | facets 15 max_values_per_field 100000\n</code></pre>\n<p>By default <code>facets</code> pipe doesn&#39;t return log fields with too long values. The limit can be changed during query via <code>max_value_len K</code> suffix.\nFor example, the following query returns the most frequent values for all the log fields containing values no longer than 100 bytes:</p>\n<pre><code class=\"language-logsql\">_time:1h error | facets max_value_len 100\n</code></pre>\n<p>By default <code>facets</code> pipe doesn&#39;t return log fields, which contain a single constant value across all the selected logs, since such facets aren&#39;t interesting in most cases.\nAdd <code>keep_const_fields</code> suffix to the <code>facets</code> pipe in order to get such fields:</p>\n<pre><code class=\"language-logsql\">_time:1h error | facets keep_const_fields\n</code></pre>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#top-pipe\"><code>top</code></a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#field_names-pipe\"><code>field_names</code></a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#field_values-pipe\"><code>field_values</code></a></li>\n</ul>\n</div>"
  },
  {
    "id": "field-names-pipe",
    "value": "field_names",
    "title": "field_names pipe",
    "description": "<div class='vm-markdown'><p><code>&lt;q&gt; | field_names</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> returns all the names of <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">log fields</a>\nwith an estimated number of logs for each field name returned from <code>&lt;q&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a>.</p>\n<p>For example, the following query returns all the field names with the number of matching logs over the last 5 minutes:</p>\n<pre><code class=\"language-logsql\">_time:5m | field_names\n</code></pre>\n<p>Field names are returned in arbitrary order. Use <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#sort-pipe\"><code>sort</code> pipe</a> in order to sort them if needed.</p>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#field_values-pipe\"><code>field_values</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#facets-pipe\"><code>facets</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#uniq-pipe\"><code>uniq</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "field-values-pipe",
    "value": "field_values",
    "title": "field_values pipe",
    "description": "<div class='vm-markdown'><p><code>&lt;q&gt; | field_values field_name</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> returns all the values for the given <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\"><code>field_name</code> field</a>\nwith the number of logs for each value returned from <code>&lt;q&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a>.\nFor example, the following query returns all the values with the number of matching logs for the field <code>level</code> over logs for the last 5 minutes:</p>\n<pre><code class=\"language-logsql\">_time:5m | field_values level\n</code></pre>\n<p>It is possible to limit the number of returned values by adding <code>limit N</code> to the end of <code>field_values ...</code>. For example, the following query returns\nup to 10 values for the field <code>user_id</code> over logs for the last 5 minutes:</p>\n<pre><code class=\"language-logsql\">_time:5m | field_values user_id limit 10\n</code></pre>\n<p>If the limit is reached, then the set of returned values is random. Also the number of matching logs for each returned value is zeroed for performance reasons.</p>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#field_names-pipe\"><code>field_names</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#facets-pipe\"><code>facets</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#top-pipe\"><code>top</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#uniq-pipe\"><code>uniq</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "fields-pipe",
    "value": "fields",
    "title": "fields pipe",
    "description": "<div class='vm-markdown'><p>By default all the <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">log fields</a> are returned in the response.\nIt is possible to select the given set of log fields with <code>| fields field1, ..., fieldN</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a>. For example, the following query selects only <code>host</code>\nand <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\"><code>_msg</code></a> fields from logs for the last 5 minutes:</p>\n<pre><code class=\"language-logsql\">_time:5m | fields host, _msg\n</code></pre>\n<p><code>keep</code> can be used instead of <code>fields</code> for convenience. For example, the following query is equivalent to the previous one:</p>\n<pre><code class=\"language-logsql\">_time:5m | keep host, _msg\n</code></pre>\n<p>It is possible to use wildcard prefixes in the list of fields to keep. For example, the following query keeps all the fields with names starting with <code>foo</code> prefix,\nwhile drops the rest of the fields:</p>\n<pre><code class=\"language-logsql\">_time:5m | fields foo*\n</code></pre>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#copy-pipe\"><code>copy</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#rename-pipe\"><code>rename</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#delete-pipe\"><code>delete</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "filter-pipe",
    "value": "filter",
    "title": "filter pipe",
    "description": "<div class='vm-markdown'><p>The <code>&lt;q&gt; | filter ...</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> filters logs returned by <code>&lt;q&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a> with the given <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#filters\">filter</a>.</p>\n<p>For example, the following query returns <code>host</code> <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">field</a> values\nif the number of log messages with the <code>error</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#word\">word</a> for them over the last hour exceeds <code>1_000</code>:</p>\n<pre><code class=\"language-logsql\">_time:1h error | stats by (host) count() logs_count | filter logs_count:&gt; 1_000\n</code></pre>\n<p>It is allowed to use <code>where</code> prefix instead of <code>filter</code> prefix for convenience. For example, the following query is equivalent to the previous one:</p>\n<pre><code class=\"language-logsql\">_time:1h error | stats by (host) count() logs_count | where logs_count:&gt; 1_000\n</code></pre>\n<p>It is allowed to omit <code>filter</code> prefix if the used filters do not clash with <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe names</a>.\nSo the following query is equivalent to the previous one:</p>\n<pre><code class=\"language-logsql\">_time:1h error | stats by (host) count() logs_count | logs_count:&gt; 1_000\n</code></pre>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#stats-pipe\"><code>stats</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#sort-pipe\"><code>sort</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "first-pipe",
    "value": "first",
    "title": "first pipe",
    "description": "<div class='vm-markdown'><p><code>&lt;q&gt; | first N by (fields)</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> returns the first <code>N</code> logs from <code>&lt;q&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a> after sorting them\nby the given <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\"><code>fields</code></a>.</p>\n<p>For example, the following query returns the first 10 logs with the smallest value of <code>request_duration</code> <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">field</a>\nover the last 5 minutes:</p>\n<pre><code class=\"language-logsql\">_time:5m | first 10 by (request_duration)\n</code></pre>\n<p>It is possible to return up to <code>N</code> logs individually for each group of logs with the same set of <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">fields</a>,\nby enumerating the set of these fields in <code>partition by (...)</code>.\nFor example, the following query returns up to 3 logs with the smallest <code>request_duration</code> for each host over the last hour:</p>\n<pre><code class=\"language-logsql\">_time:1h | first 3 by (request_duration) partition by (host)\n</code></pre>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#last-pipe\"><code>last</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#sort-pipe\"><code>sort</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "format-pipe",
    "value": "format",
    "title": "format pipe",
    "description": "<div class='vm-markdown'><p><code>&lt;q&gt; | format &quot;pattern&quot; as result_field</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> combines <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">log fields</a>\nfrom <code>&lt;q&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a> results according to the <code>pattern</code> and stores it into <code>result_field</code>.</p>\n<p>For example, the following query stores <code>request from &lt;ip&gt;:&lt;port&gt;</code> text into <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\"><code>_msg</code> field</a>,\nby substituting <code>&lt;ip&gt;</code> and <code>&lt;port&gt;</code> with the corresponding <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">log field</a> values:</p>\n<pre><code class=\"language-logsql\">_time:5m | format &quot;request from &lt;ip&gt;:&lt;port&gt;&quot; as _msg\n</code></pre>\n<p>If the result of the <code>format</code> pattern is stored into <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\"><code>_msg</code> field</a>,\nthen <code>as _msg</code> part can be omitted. The following query is equivalent to the previous one:</p>\n<pre><code class=\"language-logsql\">_time:5m | format &quot;request from &lt;ip&gt;:&lt;port&gt;&quot;\n</code></pre>\n<p>String fields can be formatted with the following additional formatting rules:</p>\n<ul>\n<li><p>The number of seconds in the <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#duration-values\">duration value</a> - add <code>duration_seconds:</code> in front of the corresponding field name.\nThe formatted number is fractional if the duration value contains non-zero milliseconds, microseconds or nanoseconds.</p>\n</li>\n<li><p>JSON-compatible quoted string - add <code>q:</code> in front of the corresponding field name.\nFor example, the following query generates properly encoded JSON object from <code>_msg</code> and <code>stacktrace</code>\n<a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">log fields</a> and stores it into <code>my_json</code> output field:</p>\n<pre><code class=\"language-logsql\">_time:5m | format &#39;{&quot;_msg&quot;:&lt;q:_msg&gt;,&quot;stacktrace&quot;:&lt;q:stacktrace&gt;}&#39; as my_json\n</code></pre>\n</li>\n<li><p>Uppercase and lowercase strings - add <code>uc:</code> or <code>lc:</code> in front of the corresponding field name.\nFor example, the following query stores uppercase value of <code>foo</code> field and lowercase value of <code>bar</code> field in the <code>result</code> field:</p>\n<pre><code class=\"language-logsql\">_time:5m | format &#39;uppercase foo: &lt;uc:foo&gt;, lowercase bar: &lt;lc:bar&gt;&#39; as result\n</code></pre>\n</li>\n<li><p><a href=\"https://en.wikipedia.org/wiki/Percent-encoding\">URL encoding</a> and decoding (aka <code>percent encoding</code>) - add <code>urlencode:</code> or <code>urldecode:</code>\nin front of the corresponding field name. For example, the following query properly encodes <code>user</code> field in the url query arg:</p>\n<pre><code class=\"language-logsql\">_time:5m | format &#39;url: http://foo.com/?user=&lt;urlencode:user&gt;&#39;\n</code></pre>\n</li>\n<li><p>Hex encoding and decoding - add <code>hexencode:</code> or <code>hexdecode:</code> in front of the corresponding field name.\nFor example, the following query hex-encodes <code>password</code> field:</p>\n<pre><code class=\"language-logsql\">_time:5m | format &#39;hex-encoded password: &lt;hexencode:password&gt;&#39;\n</code></pre>\n</li>\n<li><p><a href=\"https://en.wikipedia.org/wiki/Base64\">Base64 encoding</a> and decoding - add <code>base64encode:</code> or <code>base64decode:</code> in front of the corresponding\nfield name. For example, the following query base64-encodes <code>password</code> field:</p>\n<pre><code class=\"language-logsql\">_time:5m | format &#39;base64-encoded password: &lt;base64encode:password&gt;&#39;\n</code></pre>\n</li>\n<li><p>Converting of hexadecimal number to decimal number - add <code>hexnumdecode:</code> in front of the corresponding field name. For example, <code>format &quot;num=&lt;hexnumdecode:some_hex_field&gt;&quot;</code>.</p>\n</li>\n</ul>\n<p>Numeric fields can be transformed into the following string representation at <code>format</code> pipe:</p>\n<ul>\n<li><p><a href=\"https://www.rfc-editor.org/rfc/rfc3339\">RFC3339 time</a> - by adding <code>time:</code> in front of the corresponding field name\ncontaining <a href=\"https://en.wikipedia.org/wiki/Unix_time\">Unix timestamp</a>.\nThe numeric timestamp can be in seconds, milliseconds, microseconds, or nanoseconds — the precision is automatically detected based on the value.\nBoth integer and floating-point values are supported.\nFor example, <code>format &quot;time=&lt;time:timestamp&gt;&quot;</code>.</p>\n</li>\n<li><p>Human-readable duration - by adding <code>duration:</code> in front of the corresponding numeric field name containing duration in nanoseconds.\nFor example, <code>format &quot;duration=&lt;duration:duration_nsecs&gt;&quot;</code>. The duration can be converted into nanoseconds with the <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#math-pipe\"><code>math</code> pipe</a>.</p>\n</li>\n<li><p>IPv4 - by adding <code>ipv4:</code> in front of the corresponding field name containing <code>uint32</code> representation of the IPv4 address.\nFor example, <code>format &quot;ip=&lt;ipv4:ip_num&gt;&quot;</code>.</p>\n</li>\n<li><p>Zero-padded 64-bit hex number - by adding <code>hexnumencode:</code> in front of the corresponding field name. For example, <code>format &quot;hex_num=&lt;hexnumencode:some_field&gt;&quot;</code>.</p>\n</li>\n</ul>\n<p>Add <code>keep_original_fields</code> to the end of <code>format ... as result_field</code> when the original non-empty value of the <code>result_field</code> must be preserved\ninstead of overwriting it with the <code>format</code> results. For example, the following query adds formatted result to <code>foo</code> field only if it was missing or empty:</p>\n<pre><code class=\"language-logsql\">_time:5m | format &#39;some_text&#39; as foo keep_original_fields\n</code></pre>\n<p>Add <code>skip_empty_results</code> to the end of <code>format ...</code> if empty results shouldn&#39;t be written to the output. For example, the following query adds formatted result to <code>foo</code> field\nwhen at least <code>field1</code> or <code>field2</code> aren&#39;t empty, while preserving the original <code>foo</code> value:</p>\n<pre><code class=\"language-logsql\">_time:5m | format &quot;&lt;field1&gt;&lt;field2&gt;&quot; as foo skip_empty_results\n</code></pre>\n<p>Performance tip: it is recommended using more specific <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#filters\">log filters</a> in order to reduce the number of log entries, which are passed to <code>format</code>.\nSee <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#performance-tips\">general performance tips</a> for details.</p>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#conditional-format\">Conditional format</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#replace-pipe\"><code>replace</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#replace_regexp-pipe\"><code>replace_regexp</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#extract-pipe\"><code>extract</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "generate-sequence-pipe",
    "value": "generate_sequence",
    "title": "generate_sequence pipe",
    "description": "<div class='vm-markdown'><p>The <code>&lt;q&gt; | generate_sequence &lt;N&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> skips all the <code>&lt;q&gt;</code> results and generates <code>&lt;N&gt;</code> output logs\nwith the <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\"><code>_msg</code> field</a> containing integer sequence starting from 0 and ending at <code>N-1</code>.</p>\n<p>This pipe is useful for testing and debugging of the LogsQL pipes. For example, the following query generates 1000 random integers in the range <code>[0..9]</code>\nand collects the statistics on the number of hits for each random number:</p>\n<pre><code class=\"language-logsql\">* | generate_sequence 1000\n    | math round(rand()*10) as rand_num\n    | stats by (rand_num) count() hits\n    | sort by (rand_num)\n</code></pre>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#math-pipe\"><code>rand()</code> function from <code>math</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#stats-pipe\"><code>stats</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "hash-pipe",
    "value": "hash",
    "title": "hash pipe",
    "description": "<div class='vm-markdown'><p><code>&lt;q&gt; | hash(field) as result_field</code> calculates hash value for the given <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\"><code>field</code></a>\nand stores it into the <code>result_field</code>, for every log entry returned by <code>&lt;q&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a>.</p>\n<p>For example, the following query calculates the hash value over <code>user_id</code> field and stores it into <code>user_id_hash</code> field, across logs for the last 5 minutes:</p>\n<pre><code class=\"language-logsql\">_time:5m | hash(user_id) as user_id_hash\n</code></pre>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#math-pipe\"><code>math</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#filter-pipe\"><code>filter</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "join-pipe",
    "value": "join",
    "title": "join pipe",
    "description": "<div class='vm-markdown'><p>The <code>&lt;q1&gt; | join by (&lt;fields&gt;) (&lt;q2&gt;)</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> joins <code>&lt;q1&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a> results with the <code>&lt;q2&gt;</code> results by the given set of comma-separated <code>&lt;fields&gt;</code>.\nThis pipe works in the following way:</p>\n<ol>\n<li>It executes the <code>&lt;q2&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a> and remembers its results.</li>\n<li>For each input row from <code>&lt;q1&gt;</code> it searches for matching rows in the <code>&lt;q2&gt;</code> results by the given <code>&lt;fields&gt;</code>.</li>\n<li>If the <code>&lt;q2&gt;</code> results have no matching rows, then the input row is sent to the output as is.</li>\n<li>If the <code>&lt;q2&gt;</code> results have matching rows, then for each matching row the input row is extended\nwith new fields seen at the matching row, and the result is sent to the output.</li>\n</ol>\n<p>This logic is similar to <code>LEFT JOIN</code> in SQL. For example, the following query returns the number of per-user logs across two applications — <code>app1</code> and <code>app2</code> (see\n<a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#stream-filter\">stream filters</a> for details on the <code>{...}</code> filter):</p>\n<pre><code class=\"language-logsql\">_time:1d {app=&quot;app1&quot;} | stats by (user) count() app1_hits\n  | join by (user) (\n    _time:1d {app=&quot;app2&quot;} | stats by (user) count() app2_hits\n  )\n</code></pre>\n<p>If you need results similar to <code>INNER JOIN</code> in SQL, then add <code>inner</code> suffix after the <code>join</code> pipe.\nFor example, the following query returns stats only for users, which exist in both applications <code>app1</code> and <code>app2</code>:</p>\n<pre><code class=\"language-logsql\">_time:1d {app=&quot;app1&quot;} | stats by (user) count() app1_hits\n  | join by (user) (\n    _time:1d {app=&quot;app2&quot;} | stats by (user) count() app2_hits\n  ) inner\n</code></pre>\n<p>It is possible to add a prefix to all the field names returned by the <code>&lt;query&gt;</code> by specifying the needed prefix after the <code>&lt;query&gt;</code>.\nFor example, the following query adds <code>app2.</code> prefix to all <code>&lt;query&gt;</code> log fields:</p>\n<pre><code class=\"language-logsql\">_time:1d {app=&quot;app1&quot;} | stats by (user) count() app1_hits\n  | join by (user) (\n    _time:1d {app=&quot;app2&quot;} | stats by (user) count() app2_hits\n  ) prefix &quot;app2.&quot;\n</code></pre>\n<p><strong>Performance tips</strong>:</p>\n<ul>\n<li>Make sure that the <code>&lt;query&gt;</code> in the <code>join</code> pipe returns relatively small number of results, since they are kept in RAM during execution of <code>join</code> pipe.</li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#stats-with-additional-filters\">Conditional <code>stats</code></a> is usually faster to execute.\nThey usually require less RAM than the equivalent <code>join</code> pipe.</li>\n</ul>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#subquery-filter\">subquery filter</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#stats-pipe\"><code>stats</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#stats-with-additional-filters\">conditional <code>stats</code></a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#filter-pipe\"><code>filter</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "json-array-len-pipe",
    "value": "json_array_len",
    "title": "json_array_len pipe",
    "description": "<div class='vm-markdown'><p><code>&lt;q&gt; | json_array_len(field) as result_field</code> calculates the length of JSON array at the given <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\"><code>field</code></a>\nand stores it into the <code>result_field</code>, for every log entry returned by <code>&lt;q&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a>.</p>\n<p>For example, the following query returns top 5 logs that contain <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\">log messages</a>\nwith the biggest number of <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#word\">words</a> across all the logs for the last 5 minutes:</p>\n<pre><code class=\"language-logsql\">_time:5m | unpack_words _msg as words | json_array_len (words) as words_count | first 5 (words_count desc)\n</code></pre>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#len-pipe\"><code>len</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#unpack_words-pipe\"><code>unpack_words</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#first-pipe\"><code>first</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "last-pipe",
    "value": "last",
    "title": "last pipe",
    "description": "<div class='vm-markdown'><p><code>&lt;q&gt; | last N by (fields)</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> returns the last <code>N</code> logs from <code>&lt;q&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a> after sorting them\nby the given <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\"><code>fields</code></a>.</p>\n<p>For example, the following query returns the last 10 logs with the biggest value of <code>request_duration</code> <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">field</a>\nover the last 5 minutes:</p>\n<pre><code class=\"language-logsql\">_time:5m | last 10 by (request_duration)\n</code></pre>\n<p>It is possible to return up to <code>N</code> logs individually for each group of logs with the same set of <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">fields</a>,\nby enumerating the set of these fields in <code>partition by (...)</code>.\nFor example, the following query returns up to 3 logs with the biggest <code>request_duration</code> for each host over the last hour:</p>\n<pre><code class=\"language-logsql\">_time:1h | last 3 by (request_duration) partition by (host)\n</code></pre>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#first-pipe\"><code>first</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#sort-pipe\"><code>sort</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "len-pipe",
    "value": "len",
    "title": "len pipe",
    "description": "<div class='vm-markdown'><p><code>&lt;q&gt; | len(field) as result</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> stores byte length of the given <code>field</code> value into the <code>result</code> field\nacross all the logs returned by <code>&lt;q&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a>.</p>\n<p>For example, the following query shows top 5 log entries with the maximum byte length of <code>_msg</code> field across\nlogs for the last 5 minutes:</p>\n<pre><code class=\"language-logsql\">_time:5m | len(_msg) as msg_len | sort by (msg_len desc) | limit 5\n</code></pre>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#json_array_len-pipe\"><code>json_array_len</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#sum_len-stats\"><code>sum_len</code> stats function</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#sort-pipe\"><code>sort</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#limit-pipe\"><code>limit</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#block_stats-pipe\"><code>block_stats</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "limit-pipe",
    "value": "limit",
    "title": "limit pipe",
    "description": "<div class='vm-markdown'><p>If only a subset of selected logs must be processed, then <code>| limit N</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> can be used, where <code>N</code> can contain any <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#numeric-values\">supported integer numeric value</a>.\nFor example, the following query returns up to 100 logs over the last 5 minutes:</p>\n<pre><code class=\"language-logsql\">_time:5m | limit 100\n</code></pre>\n<p><code>head</code> keyword can be used instead of <code>limit</code> for convenience. For example, <code>_time:5m | head 100</code> is equivalent to <code>_time:5m | limit 100</code>.</p>\n<p>The <code>N</code> in <code>head N</code> can be omitted - in this case up to 10 matching logs are returned:</p>\n<pre><code class=\"language-logsql\">error | head\n</code></pre>\n<p>By default rows are selected in arbitrary order for performance reasons, so the query above can return different sets of logs every time it is executed.\n<a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#sort-pipe\"><code>sort</code> pipe</a> can be used for making sure the logs are in the same order before applying <code>limit ...</code> to them.</p>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#sample-pipe\"><code>sample</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#sort-pipe\"><code>sort</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#offset-pipe\"><code>offset</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "math-pipe",
    "value": "math",
    "title": "math pipe",
    "description": "<div class='vm-markdown'><p><code>&lt;q&gt; | math ...</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> performs mathematical calculations over <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#numeric-values\">numeric values</a> of <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">log fields</a>\nreturned by <code>&lt;q&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a>. It has the following format:</p>\n<pre><code>| math\n  expr1 as resultName1,\n  ...\n  exprN as resultNameN\n</code></pre>\n<p>Where <code>exprX</code> is one of the supported math expressions mentioned below, while <code>resultNameX</code> is the name of the field to store the calculated result to.\nThe <code>as</code> keyword is optional. The result name can be omitted. In this case the result is stored to a field with the name equal to string representation\nof the corresponding math expression.</p>\n<p><code>exprX</code> may reference <code>resultNameY</code> calculated before the given <code>exprX</code>.</p>\n<p>For example, the following query divides <code>duration_msecs</code> field value by 1000, then rounds it to integer and stores the result in the <code>duration_secs</code> field:</p>\n<pre><code class=\"language-logsql\">_time:5m | math round(duration_msecs / 1000) as duration_secs\n</code></pre>\n<p>The following mathematical operations are supported by <code>math</code> pipe:</p>\n<ul>\n<li><code>arg1 + arg2</code> - returns the sum of <code>arg1</code> and <code>arg2</code></li>\n<li><code>arg1 - arg2</code> - returns the difference between <code>arg1</code> and <code>arg2</code></li>\n<li><code>arg1 * arg2</code> - multiplies <code>arg1</code> by <code>arg2</code></li>\n<li><code>arg1 / arg2</code> - divides <code>arg1</code> by <code>arg2</code></li>\n<li><code>arg1 % arg2</code> - returns the remainder of the division of <code>arg1</code> by <code>arg2</code></li>\n<li><code>arg1 ^ arg2</code> - returns the power of <code>arg1</code> by <code>arg2</code></li>\n<li><code>arg1 &amp; arg2</code> - returns bitwise <code>and</code> for <code>arg1</code> and <code>arg2</code>. It is expected that <code>arg1</code> and <code>arg2</code> are in the range <code>[0 .. 2^53-1]</code></li>\n<li><code>arg1 or arg2</code> - returns bitwise <code>or</code> for <code>arg1</code> and <code>arg2</code>. It is expected that <code>arg1</code> and <code>arg2</code> are in the range <code>[0 .. 2^53-1]</code></li>\n<li><code>arg1 xor arg2</code> - returns bitwise <code>xor</code> for <code>arg1</code> and <code>arg2</code>. It is expected that <code>arg1</code> and <code>arg2</code> are in the range <code>[0 .. 2^53-1]</code></li>\n<li><code>arg1 default arg2</code> - returns <code>arg2</code> if <code>arg1</code> is non-<a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#numeric-values\">numeric</a> or equals <code>NaN</code></li>\n<li><code>abs(arg)</code> - returns an absolute value for the given <code>arg</code></li>\n<li><code>ceil(arg)</code> - returns the least integer value greater than or equal to <code>arg</code></li>\n<li><code>exp(arg)</code> - powers <a href=\"https://en.wikipedia.org/wiki/E_(mathematical_constant)\"><code>e</code></a> by <code>arg</code></li>\n<li><code>floor(arg)</code> - returns the greatest integer value less than or equal to <code>arg</code></li>\n<li><code>ln(arg)</code> - returns <a href=\"https://en.wikipedia.org/wiki/Natural_logarithm\">natural logarithm</a> for the given <code>arg</code></li>\n<li><code>max(arg1, ..., argN)</code> - returns the maximum value among the given <code>arg1</code>, ..., <code>argN</code></li>\n<li><code>min(arg1, ..., argN)</code> - returns the minimum value among the given <code>arg1</code>, ..., <code>argN</code></li>\n<li><code>now()</code> - returns the current <a href=\"https://en.wikipedia.org/wiki/Unix_time\">Unix timestamp</a> in nanoseconds.</li>\n<li><code>rand()</code> - returns pseudo-random number in the range <code>[0...1)</code>.</li>\n<li><code>round(arg)</code> - returns rounded to integer value for the given <code>arg</code>. The <code>round()</code> accepts optional <code>nearest</code> arg, which allows rounding the number to the given <code>nearest</code> multiple.\nFor example, <code>round(temperature, 0.1)</code> rounds <code>temperature</code> field to one decimal digit after the point.</li>\n</ul>\n<p>Every <code>argX</code> argument in every mathematical operation can contain one of the following values:</p>\n<ul>\n<li>The name of <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">log field</a>. For example, <code>errors_total / requests_total</code>.\nThe log field is parsed into numeric value if it contains <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#numeric-values\">supported numeric value</a>. The log field is parsed into <a href=\"https://en.wikipedia.org/wiki/Unix_time\">Unix timestamp</a>\nin nanoseconds if it contains <a href=\"https://www.rfc-editor.org/rfc/rfc3339\">rfc3339 time</a>. The log field is parsed into <code>uint32</code> number if it contains IPv4 address.\nThe log field is parsed into <code>NaN</code> in other cases.</li>\n<li>Any <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#numeric-values\">supported numeric value</a>, <a href=\"https://www.rfc-editor.org/rfc/rfc3339\">rfc3339 time</a> or IPv4 address. For example, <code>1MiB</code>, <code>&quot;2024-05-15T10:20:30.934324Z&quot;</code> or <code>&quot;12.34.56.78&quot;</code>.</li>\n<li>Another mathematical expression, which can be put inside <code>(...)</code>. For example, <code>(a + b) * c</code>.</li>\n</ul>\n<p>The parsed time, duration and IPv4 address can be converted back to string representation after math transformations with the help of <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#format-pipe\"><code>format</code> pipe</a>. For example,\nthe following query rounds the <code>request_duration</code> <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">field</a> to seconds before converting it back to string representation:</p>\n<pre><code class=\"language-logsql\">_time:5m | math round(request_duration, 1e9) as request_duration_nsecs | format &#39;&lt;duration:request_duration_nsecs&gt;&#39; as request_duration\n</code></pre>\n<p>The <code>eval</code> keyword can be used instead of <code>math</code> for convenience. For example, the following query calculates <code>duration_msecs</code> field\nby multiplying <code>duration_secs</code> <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">field</a> to <code>1000</code>:</p>\n<pre><code class=\"language-logsql\">_time:5m | eval (duration_secs * 1000) as duration_msecs\n</code></pre>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#stats-pipe\"><code>stats</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#extract-pipe\"><code>extract</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#format-pipe\"><code>format</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "offset-pipe",
    "value": "offset",
    "title": "offset pipe",
    "description": "<div class='vm-markdown'><p>If some selected logs must be skipped after <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#sort-pipe\"><code>sort</code></a>, then <code>| offset N</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> can be used, where <code>N</code> can contain any <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#numeric-values\">supported integer numeric value</a>.\nFor example, the following query skips the first 100 logs over the last 5 minutes after sorting them by <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#time-field\"><code>_time</code></a>:</p>\n<pre><code class=\"language-logsql\">_time:5m | sort by (_time) | offset 100\n</code></pre>\n<p><code>skip</code> keyword can be used instead of <code>offset</code> keyword for convenience. For example, <code>_time:5m | skip 10</code> is equivalent to <code>_time:5m | offset 10</code>.</p>\n<p>Note that skipping rows without sorting makes little sense, since they can be returned in arbitrary order for performance reasons.\nRows can be sorted with <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#sort-pipe\"><code>sort</code> pipe</a>.</p>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#limit-pipe\"><code>limit</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#sort-pipe\"><code>sort</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "pack-json-pipe",
    "value": "pack_json",
    "title": "pack_json pipe",
    "description": "<div class='vm-markdown'><p><code>&lt;q&gt; | pack_json as field_name</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> packs all the <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">fields</a> of every log\nentry returned by <code>&lt;q&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a> into JSON object and stores it as a string in the given <code>field_name</code>.</p>\n<p>For example, the following query packs all the fields into JSON object and stores it into <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\"><code>_msg</code> field</a>\nfor logs over the last 5 minutes:</p>\n<pre><code class=\"language-logsql\">_time:5m | pack_json as _msg\n</code></pre>\n<p>The <code>as _msg</code> part can be omitted if packed JSON object is stored into <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\"><code>_msg</code> field</a>.\nThe following query is equivalent to the previous one:</p>\n<pre><code class=\"language-logsql\">_time:5m | pack_json\n</code></pre>\n<p>If only a subset of fields must be packed into JSON, then it must be listed inside <code>fields (...)</code> after <code>pack_json</code>. For example, the following query builds JSON with <code>foo</code> and <code>bar</code> fields\nonly and stores the result in <code>baz</code> field:</p>\n<pre><code class=\"language-logsql\">_time:5m | pack_json fields (foo, bar) as baz\n</code></pre>\n<p>It is possible to pass field prefixes into <code>fields (...)</code> in order to pack only the fields, which start with the given prefixes.\nFor example, the following query builds JSON with all the fields, which start with either <code>foo.</code> or <code>bar.</code>:</p>\n<pre><code class=\"language-logsql\">_time:5m | pack_json fields (foo.*, bar.*) as baz\n</code></pre>\n<p>The <code>pack_json</code> doesn&#39;t modify or delete other fields. If you do not need them, then add <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#fields-pipe\"><code>| fields ...</code></a> after the <code>pack_json</code> pipe. For example, the following query\nleaves only the <code>foo</code> field with the original log fields packed into JSON:</p>\n<pre><code class=\"language-logsql\">_time:5m | pack_json as foo | fields foo\n</code></pre>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pack_logfmt-pipe\"><code>pack_logfmt</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#unpack_json-pipe\"><code>unpack_json</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "pack-logfmt-pipe",
    "value": "pack_logfmt",
    "title": "pack_logfmt pipe",
    "description": "<div class='vm-markdown'><p><code>&lt;q&gt; | pack_logfmt as field_name</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> packs all the <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">fields</a> for every log entry\nreturned by <code>&lt;q&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a> into <a href=\"https://brandur.org/logfmt\">logfmt</a> message and stores it as a string in the given <code>field_name</code>.</p>\n<p>For example, the following query packs all the fields into <a href=\"https://brandur.org/logfmt\">logfmt</a> message and stores it\ninto <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\"><code>_msg</code> field</a> for logs over the last 5 minutes:</p>\n<pre><code class=\"language-logsql\">_time:5m | pack_logfmt as _msg\n</code></pre>\n<p>The <code>as _msg</code> part can be omitted if packed message is stored into <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\"><code>_msg</code> field</a>.\nThe following query is equivalent to the previous one:</p>\n<pre><code class=\"language-logsql\">_time:5m | pack_logfmt\n</code></pre>\n<p>If only a subset of fields must be packed into <a href=\"https://brandur.org/logfmt\">logfmt</a>, then it must be listed inside <code>fields (...)</code> after <code>pack_logfmt</code>.\nFor example, the following query builds <a href=\"https://brandur.org/logfmt\">logfmt</a> message with <code>foo</code> and <code>bar</code> fields only and stores the result in <code>baz</code> field:</p>\n<pre><code class=\"language-logsql\">_time:5m | pack_logfmt fields (foo, bar) as baz\n</code></pre>\n<p>It is possible to pass field prefixes into <code>fields (...)</code> in order to pack only the fields, which start with the given prefixes.\nFor example, the following query builds <code>logfmt</code> message with all the fields, which start with either <code>foo.</code> or <code>bar.</code>:</p>\n<pre><code class=\"language-logsql\">_time:5m | pack_logfmt fields (foo.*, bar.*) as baz\n</code></pre>\n<p>The <code>pack_logfmt</code> doesn&#39;t modify or delete other fields. If you do not need them, then add <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#fields-pipe\"><code>| fields ...</code></a> after the <code>pack_logfmt</code> pipe. For example, the following query\nleaves only the <code>foo</code> field with the original log fields packed into <a href=\"https://brandur.org/logfmt\">logfmt</a>:</p>\n<pre><code class=\"language-logsql\">_time:5m | pack_logfmt as foo | fields foo\n</code></pre>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pack_json-pipe\"><code>pack_json</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#unpack_logfmt-pipe\"><code>unpack_logfmt</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "query-stats-pipe",
    "value": "query_stats",
    "title": "query_stats pipe",
    "description": "<div class='vm-markdown'><p>The <code>&lt;q&gt; | query_stats</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> returns the following execution statistics for the given <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query <code>&lt;q&gt;</code></a>:</p>\n<ul>\n<li><code>BytesReadColumnsHeaders</code> - the number of bytes read from disk for column headers. Use <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#fields-pipe\"><code>fields</code> pipe</a> for reducing the number of bytes read for column headers.</li>\n<li><code>BytesReadColumnsHeaderIndexes</code> - the number of bytes read from disk for column header indexes.</li>\n<li><code>BytesReadBloomFilters</code> - the number of bytes read from disk for bloom filters.</li>\n<li><code>BytesReadValues</code> - the number of bytes read from disk for <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">log fields</a>.\n Use <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#fields-pipe\"><code>fields</code> pipe</a> for reducing the number of bytes read for log field values.</li>\n<li><code>BytesReadTimestamps</code> - the number of bytes read from disk for <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#time-field\"><code>_time</code> field</a>.</li>\n<li><code>BytesReadBlockHeaders</code> - the number of bytes read from disk for block headers.</li>\n<li><code>BytesReadTotal</code> - the total number of bytes read from disk.</li>\n<li><code>BlocksProcessed</code> - the number of data blocks processed during query execution. Use more narrow <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#time-filter\">time filter</a> and <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#stream-filter\">log stream filter</a>\nfor reducing the number of data blocks processed.</li>\n<li><code>RowsProcessed</code> - the number of log entries processed during query execution. Use more narrow <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#time-filter\">time filter</a> and <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#stream-filter\">log stream filter</a>\nfor reducing the number of processed log entries.</li>\n<li><code>RowsFound</code> - the number of log entries found by the query.</li>\n<li><code>ValuesRead</code> - the number of <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">log field values</a> read during query processing.\nUse <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#fields-pipe\"><code>fields</code> pipe</a> for reducing the number of field values read.</li>\n<li><code>TimestampsRead</code> - the number of <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#time-field\"><code>_time</code> fields</a> read during query processing.</li>\n<li><code>BytesProcessedUncompressedValues</code> - the number of uncompressed bytes for <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">log field values</a>,\nwhich are processed during query execution.</li>\n<li><code>QueryDurationNsecs</code> - the duration of the query in nanoseconds. It can be used for calculating various rates over the query stats with the <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#math-pipe\"><code>math</code> pipe</a>.</li>\n</ul>\n<p>This pipe is useful for investigation and optimizing slow queries.</p>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#block_stats-pipe\"><code>block_stats</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#troubleshooting\">query troubleshooting</a></li>\n</ul>\n</div>"
  },
  {
    "id": "rename-pipe",
    "value": "rename",
    "title": "rename pipe",
    "description": "<div class='vm-markdown'><p>If some <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">log fields</a> must be renamed, then <code>| rename src1 as dst1, ..., srcN as dstN</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> can be used.\nFor example, the following query renames <code>host</code> field to <code>server</code> for logs over the last 5 minutes, so the output contains <code>server</code> field instead of <code>host</code> field:</p>\n<pre><code class=\"language-logsql\">_time:5m | rename host as server\n</code></pre>\n<p>Multiple fields can be renamed with a single <code>| rename ...</code> pipe. For example, the following query renames <code>host</code> to <code>instance</code> and <code>app</code> to <code>job</code>:</p>\n<pre><code class=\"language-logsql\">_time:5m | rename host as instance, app as job\n</code></pre>\n<p>The <code>as</code> keyword is optional.</p>\n<p><code>mv</code> keyword can be used instead of <code>rename</code> keyword for convenience. For example, <code>_time:5m | mv foo bar</code> is equivalent to <code>_time:5m | rename foo as bar</code>.</p>\n<p>It is possible to rename multiple fields with the given prefix to fields with another prefix. For example, the following query renames all the fields\nstarting with <code>foo</code> prefix to fields starting with <code>bar</code> prefix:</p>\n<pre><code class=\"language-logsql\">_time:5m | rename foo* as bar*\n</code></pre>\n<p>It is also possible to remove the common prefix from some fields. For example, the following query removes the <code>foo</code> prefix from all the fields that start with <code>foo</code>:</p>\n<pre><code class=\"language-logsql\">_time:5m | rename foo* as *\n</code></pre>\n<p>It is also possible to add a common prefix to all the fields. For example, the following query adds the <code>foo</code> prefix to all the fields:</p>\n<pre><code class=\"language-logsql\">_time:5m | rename * as foo*\n</code></pre>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#copy-pipe\"><code>copy</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#fields-pipe\"><code>fields</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#delete-pipe\"><code>delete</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "replace-pipe",
    "value": "replace",
    "title": "replace pipe",
    "description": "<div class='vm-markdown'><p><code>&lt;q&gt; | replace (&quot;old&quot;, &quot;new&quot;) at field</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> replaces all the occurrences of the <code>old</code> substring with the <code>new</code> substring\nin the given <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\"><code>field</code></a> over all the logs returned by <code>&lt;q&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a>.</p>\n<p>For example, the following query replaces all the <code>secret-password</code> substrings with <code>***</code> in the <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\"><code>_msg</code> field</a>\nfor logs over the last 5 minutes:</p>\n<pre><code class=\"language-logsql\">_time:5m | replace (&quot;secret-password&quot;, &quot;***&quot;) at _msg\n</code></pre>\n<p>The <code>at _msg</code> part can be omitted if the replacement occurs in the <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\"><code>_msg</code> field</a>.\nThe following query is equivalent to the previous one:</p>\n<pre><code class=\"language-logsql\">_time:5m | replace (&quot;secret-password&quot;, &quot;***&quot;)\n</code></pre>\n<p>The number of replacements can be limited with <code>limit N</code> at the end of <code>replace</code>. For example, the following query replaces only the first <code>foo</code> substring with <code>bar</code>\nat the <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">log field</a> <code>baz</code>:</p>\n<pre><code class=\"language-logsql\">_time:5m | replace (&#39;foo&#39;, &#39;bar&#39;) at baz limit 1\n</code></pre>\n<p>Performance tip: it is recommended using more specific <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#filters\">log filters</a> in order to reduce the number of log entries, which are passed to <code>replace</code>.\nSee <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#performance-tips\">general performance tips</a> for details.</p>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#conditional-replace\">Conditional replace</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#replace_regexp-pipe\"><code>replace_regexp</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#collapse_nums-pipe\"><code>collapse_nums</code></a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#format-pipe\"><code>format</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#extract-pipe\"><code>extract</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "replace-regexp-pipe",
    "value": "replace_regexp",
    "title": "replace_regexp pipe",
    "description": "<div class='vm-markdown'><p><code>&lt;q&gt; | replace_regexp (&quot;regexp&quot;, &quot;replacement&quot;) at field</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> replaces all the substrings matching the given <code>regexp</code> with the given <code>replacement</code>\nin the given <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\"><code>field</code></a> over all the logs returned by <code>&lt;q&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a>.</p>\n<p>The <code>regexp</code> must contain regular expression with <a href=\"https://github.com/google/re2/wiki/Syntax\">RE2 syntax</a>.\nThe <code>replacement</code> may contain <code>$N</code> or <code>${N}</code> placeholders, which are substituted with the <code>N-th</code> capturing group in the <code>regexp</code>.</p>\n<p>For example, the following query replaces all the substrings starting with <code>host-</code> and ending with <code>-foo</code> with the contents between <code>host-</code> and <code>-foo</code> in the <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\"><code>_msg</code> field</a> for logs over the last 5 minutes:</p>\n<pre><code class=\"language-logsql\">_time:5m | replace_regexp (&quot;host-(.+?)-foo&quot;, &quot;$1&quot;) at _msg\n</code></pre>\n<p>The <code>at _msg</code> part can be omitted if the replacement occurs in the <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\"><code>_msg</code> field</a>.\nThe following query is equivalent to the previous one:</p>\n<pre><code class=\"language-logsql\">_time:5m | replace_regexp (&quot;host-(.+?)-foo&quot;, &quot;$1&quot;)\n</code></pre>\n<p>The number of replacements can be limited with <code>limit N</code> at the end of <code>replace_regexp</code>. For example, the following query replaces only the first <code>password: ...</code> substring\nending with whitespace with empty substring at the <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">log field</a> <code>baz</code>:</p>\n<pre><code class=\"language-logsql\">_time:5m | replace_regexp (&#39;password: [^ ]+&#39;, &#39;&#39;) at baz limit 1\n</code></pre>\n<p>Performance tips:</p>\n<ul>\n<li>It is recommended to use the <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#replace-pipe\"><code>replace</code> pipe</a> instead of <code>replace_regexp</code> if possible, since it works faster.</li>\n<li>It is recommended to use more specific <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#filters\">log filters</a> in order to reduce the number of log entries that are passed to <code>replace_regexp</code>.\nSee <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#performance-tips\">general performance tips</a> for details.</li>\n</ul>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#conditional-replace_regexp\">Conditional replace_regexp</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#replace-pipe\"><code>replace</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#collapse_nums-pipe\"><code>collapse_nums</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#format-pipe\"><code>format</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#extract-pipe\"><code>extract</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#decolorize-pipe\"><code>decolorize</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "running-stats-pipe",
    "value": "running_stats",
    "title": "running_stats pipe",
    "description": "<div class='vm-markdown'><p>The <code>&lt;q&gt; | running_stats ...</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> calculates running stats (such as <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#count-running_stats\">running count</a> or <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#sum-running_stats\">running sum</a>)\nover the specified <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">log fields</a> returned by <code>&lt;q&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a>\nand stores the stats in the specified log fields for each input log entry.</p>\n<p>The running stats is calculated over the logs sorted by time, so the <code>&lt;q&gt;</code> must return the <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#time-field\"><code>_time</code> field</a>\nin order to properly calculate the running stats.</p>\n<p>The <code>running_stats</code> pipe puts all the logs returned by <code>&lt;q&gt;</code> in memory, so make sure the <code>&lt;q&gt;</code> returns the limited number of logs in order to avoid high memory usage.</p>\n<p>For example, the following LogsQL query calculates <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#sum-running_stats\">running sum</a> for the <code>hits</code> field over the logs for the last 5 minutes:</p>\n<pre><code class=\"language-logsql\">_time:5m | running_stats sum(hits) as running_hits\n</code></pre>\n<p>The <code>| running_stats ...</code> pipe has the following basic format:</p>\n<pre><code class=\"language-logsql\">... | running_stats\n  stats_func1(...) as result_name1,\n  ...\n  stats_funcN(...) as result_nameN\n</code></pre>\n<p>Where <code>stats_func*</code> is any of the supported <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#running_stats-pipe-functions\">running stats function</a>, while the <code>result_name*</code> is the name of the log field\nto store the result of the corresponding stats function. The <code>as</code> keyword is optional.</p>\n<p>For example, the following query calculates the following running stats for logs over the last 5 minutes:</p>\n<ul>\n<li>the number of logs with the help of <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#count-running_stats\"><code>count</code> function</a>;</li>\n<li>the sum of <code>hits</code> field with the help of <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#sum-running_stats\"><code>sum</code> function</a>:</li>\n</ul>\n<pre><code class=\"language-logsql\">_time:5m\n    | running_stats\n        count() as running_logs,\n        sum(hits) as running_hits\n</code></pre>\n<p>It is allowed omitting the result name. In this case the result name equals the string representation of the used <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#running_stats-pipe-functions\">running stats function</a>.\nFor example, the following query returns the same stats as the previous one, but gives <code>count()</code> and <code>sum(hits)</code> names for the returned fields:</p>\n<pre><code class=\"language-logsql\">_time:5m | running_stats count(), sum(hits)\n</code></pre>\n<p>It is useful to combine <code>running_stats</code> with <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#stats-by-time-buckets\">stats by time buckets</a>. For example, the following query returns per-hour number of logs over the last day,\nplus running number of logs.</p>\n<pre><code class=\"language-logsql\">_time:1d\n    | stats by (_time:hour) count() as hits\n    | running_stats sum(hits) as running_hits\n</code></pre>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#running_stats-pipe-functions\"><code>running_stats</code> pipe functions</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#running_stats-by-fields\"><code>running_stats</code> by fields</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#total_stats-pipe\"><code>total_stats</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#stats-pipe\"><code>stats</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#sort-pipe\"><code>sort</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "sample-pipe",
    "value": "sample",
    "title": "sample pipe",
    "description": "<div class='vm-markdown'><p>The <code>&lt;q&gt; | sample N</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> returns <code>1/N</code>th random sample of logs for the <code>&lt;q&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a>.\nFor example, the following query returns ~1% (1/100th random sample) of logs over the last hour with the <code>error</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#word\">word</a>\nin the <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\"><code>_msg</code> field</a>:</p>\n<pre><code class=\"language-logsql\">_time:1h error | sample 100\n</code></pre>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#limit-pipe\"><code>limit</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "set-stream-fields-pipe",
    "value": "set_stream_fields",
    "title": "set_stream_fields pipe",
    "description": "<div class='vm-markdown'><p>The <code>| set_stream_fields field1, ..., fieldN</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a>\nsets the given <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">log fields</a>\nas <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#stream-fields\"><code>_stream</code> fields</a>.</p>\n<p>For example, if the logs returned by <code>_time:5m</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#filters\">filter</a> have <code>host=&quot;foo&quot;</code> and <code>path=&quot;/bar&quot;</code> fields,\nthen the following query sets <code>_stream</code> field to <code>{host=&quot;foo&quot;, path=&quot;/bar&quot;}</code>:</p>\n<pre><code class=\"language-logsql\">_time:5m | set_stream_fields host, path\n</code></pre>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#conditional-set_stream_fields\">conditional <code>set_stream_fields</code></a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#format-pipe\"><code>format</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "sort-pipe",
    "value": "sort",
    "title": "sort pipe",
    "description": "<div class='vm-markdown'><p>By default logs are selected in arbitrary order for performance reasons. If logs must be sorted, then <code>&lt;q&gt; | sort by (field1, ..., fieldN)</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> can be used\nfor sorting logs returned by <code>&lt;q&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a> by the given <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">fields</a>\nusing <a href=\"https://en.wikipedia.org/wiki/Natural_sort_order\">natural sorting</a>.</p>\n<p>For example, the following query returns logs for the last 5 minutes sorted by <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#stream-fields\"><code>_stream</code></a>\nand then by <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#time-field\"><code>_time</code></a>:</p>\n<pre><code class=\"language-logsql\">_time:5m | sort by (_stream, _time)\n</code></pre>\n<p>Add <code>desc</code> after the given log field in order to sort in reverse order of this field. For example, the following query sorts logs in reverse order of <code>request_duration_seconds</code> field:</p>\n<pre><code class=\"language-logsql\">_time:5m | sort by (request_duration_seconds desc)\n</code></pre>\n<p>The reverse order can be applied globally via <code>desc</code> keyword after <code>by(...)</code> clause:</p>\n<pre><code class=\"language-logsql\">_time:5m | sort by (foo, bar) desc\n</code></pre>\n<p>The <code>by</code> keyword can be skipped in <code>sort ...</code> pipe. For example, the following query is equivalent to the previous one:</p>\n<pre><code class=\"language-logsql\">_time:5m | sort (foo, bar) desc\n</code></pre>\n<p>The <code>order</code> alias can be used instead of <code>sort</code>, so the following query is equivalent to the previous one:</p>\n<pre><code class=\"language-logsql\">_time:5m | order by (foo, bar) desc\n</code></pre>\n<p>Sorting a large number of logs can consume a lot of CPU time and memory. Sometimes it is enough to return the first <code>N</code> entries with the biggest\nor the smallest values. This can be done by adding <code>limit N</code> to the end of <code>sort ...</code> pipe.\nSuch a query consumes less memory when sorting a large number of logs, since it keeps in memory only <code>N</code> log entries.\nFor example, the following query returns top 10 log entries with the biggest values\nfor the <code>request_duration</code> <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">field</a> during the last hour:</p>\n<pre><code class=\"language-logsql\">_time:1h | sort by (request_duration desc) limit 10\n</code></pre>\n<p>This query is equivalent to the following one, which uses <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#last-pipe\"><code>last</code> pipe</a>:</p>\n<pre><code class=\"language-logsql\">_time:1h | last 10 by (request_duration)\n</code></pre>\n<p>If the first <code>N</code> sorted results must be skipped, then <code>offset N</code> can be added to <code>sort</code> pipe. For example,\nthe following query skips the first 10 logs with the biggest <code>request_duration</code> <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">field</a>,\nand then returns the next 20 sorted logs for the last 5 minutes:</p>\n<pre><code class=\"language-logsql\">_time:1h | sort by (request_duration desc) offset 10 limit 20\n</code></pre>\n<p>It is possible to sort the logs and apply the <code>limit</code> individually for each group of logs with the same set of <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">fields</a>,\nby enumerating the set of these fields in <code>partition by (...)</code>.\nFor example, the following query returns up to 3 logs with the biggest <code>request_duration</code> for each host over the last hour:</p>\n<pre><code class=\"language-logsql\">_time:1h | sort by (request_duration desc) partition by (host) limit 3\n</code></pre>\n<p>It is possible to return a rank (sort order number) for every sorted log by adding <code>rank as &lt;fieldName&gt;</code> to the end of the <code>| sort ...</code> pipe.\nFor example, the following query stores rank for sorted by <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#time-field\"><code>_time</code></a> logs\ninto <code>position</code> <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">field</a>:</p>\n<pre><code class=\"language-logsql\">_time:5m | sort by (_time) rank as position\n</code></pre>\n<p>Note that sorting a large number of logs can be slow and can consume a lot of additional memory.\nIt is recommended to limit the number of logs before sorting with the following approaches:</p>\n<ul>\n<li>Adding <code>limit N</code> to the end of <code>sort ...</code> pipe.</li>\n<li>Reducing the selected time range with <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#time-filter\">time filter</a>.</li>\n<li>Using more specific <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#filters\">filters</a>, so they select less logs.</li>\n<li>Limiting the number of selected <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">fields</a> via <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#fields-pipe\"><code>fields</code> pipe</a>.</li>\n</ul>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#first-pipe\"><code>first</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#last-pipe\"><code>last</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#top-pipe\"><code>top</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#stats-pipe\"><code>stats</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#limit-pipe\"><code>limit</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#offset-pipe\"><code>offset</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "split-pipe",
    "value": "split",
    "title": "split pipe",
    "description": "<div class='vm-markdown'><p>The <code>&lt;q&gt; | split &lt;separator&gt; from &lt;src_field&gt; as &lt;dst_field&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> splits <code>&lt;src_field&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">log field</a>\nobtained from <code>&lt;q&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a> results into <code>&lt;dst_field&gt;</code> as a JSON array, by using the given <code>&lt;separator&gt;</code>.</p>\n<p>For example, the following query splits <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\">log messages</a> by <code>,</code> and stores the results into <code>items</code> field:</p>\n<pre><code class=\"language-logsql\">_time:5m | split &quot;,&quot; from _msg as items\n</code></pre>\n<p>The <code>as &lt;dst_field&gt;</code> part is optional. If it is missing, then the result is stored in the <code>&lt;src_field&gt;</code> specified in <code>from &lt;src_field&gt;</code>.\nFor example, the following query stores the split result into <code>_msg</code> field:</p>\n<pre><code class=\"language-logsql\">_time:5m | split &quot;,&quot; from _msg\n</code></pre>\n<p>The <code>from &lt;src_field&gt;</code> part is optional. If it is missing, then the <code>_msg</code> field is used as a source field. The following query is equivalent to the previous one:</p>\n<pre><code class=\"language-logsql\">_time:5m | split &quot;,&quot;\n</code></pre>\n<p>It is convenient to use <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#unroll-pipe\"><code>unroll</code> pipe</a> for unrolling the JSON array with the split results.\nFor example, the following query returns top 5 most frequently seen comma-separated items across <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\">log messages</a>\nfor the last 5 minutes:</p>\n<pre><code class=\"language-logsql\">_time:5m | split &quot;,&quot; as items | unroll items | top 5 (items)\n</code></pre>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#unroll-pipe\"><code>unroll</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#unpack_words-pipe\"><code>unpack_words</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "stats-pipe",
    "value": "stats",
    "title": "stats pipe",
    "description": "<div class='vm-markdown'><p>The <code>&lt;q&gt; | stats ...</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> calculates various stats over the logs returned by <code>&lt;q&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a>.\nFor example, the following LogsQL query uses <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#count-stats\"><code>count</code> stats function</a> for calculating the number of logs for the last 5 minutes:</p>\n<pre><code class=\"language-logsql\">_time:5m | stats count() as logs_total\n</code></pre>\n<p>The <code>| stats ...</code> pipe has the following basic format:</p>\n<pre><code class=\"language-logsql\">... | stats\n  stats_func1(...) as result_name1,\n  ...\n  stats_funcN(...) as result_nameN\n</code></pre>\n<p>Where <code>stats_func*</code> is any of the supported <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#stats-pipe-functions\">stats function</a>, while the <code>result_name*</code> is the name of the log field\nto store the result of the corresponding stats function. The <code>as</code> keyword is optional.</p>\n<p>For example, the following query calculates the following stats for logs over the last 5 minutes:</p>\n<ul>\n<li>the number of logs with the help of <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#count-stats\"><code>count</code> stats function</a>;</li>\n<li>the number of unique <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#stream-fields\">log streams</a> with the help of <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#count_uniq-stats\"><code>count_uniq</code> stats function</a>:</li>\n</ul>\n<pre><code class=\"language-logsql\">_time:5m | stats count() logs_total, count_uniq(_stream) streams_total\n</code></pre>\n<p>It is allowed omitting <code>stats</code> prefix for convenience. So the following query is equivalent to the previous one:</p>\n<pre><code class=\"language-logsql\">_time:5m | count() logs_total, count_uniq(_stream) streams_total\n</code></pre>\n<p>It is allowed omitting the result name. In this case the result name equals the string representation of the used <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#stats-pipe-functions\">stats function</a>.\nFor example, the following query returns the same stats as the previous one, but gives <code>count()</code> and <code>count_uniq(_stream)</code> names for the returned fields:</p>\n<pre><code class=\"language-logsql\">_time:5m | count(), count_uniq(_stream)\n</code></pre>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#stats-pipe-functions\">stats pipe functions</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#stats-by-fields\">stats by fields</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#stats-by-time-buckets\">stats by time buckets</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#stats-by-time-buckets-with-timezone-offset\">stats by time buckets with timezone offset</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#stats-by-field-buckets\">stats by field buckets</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#stats-by-ipv4-buckets\">stats by IPv4 buckets</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#stats-with-additional-filters\">stats with additional filters</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#running_stats-pipe\"><code>running_stats</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#total_stats-pipe\"><code>total_stats</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#math-pipe\"><code>math</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#sort-pipe\"><code>sort</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#uniq-pipe\"><code>uniq</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#top-pipe\"><code>top</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#join-pipe\"><code>join</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "stream-context-pipe",
    "value": "stream_context",
    "title": "stream_context pipe",
    "description": "<div class='vm-markdown'><p><code>&lt;q&gt; | stream_context ...</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> allows selecting surrounding logs in a <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#stream-fields\">log stream</a>\nacross the logs returned by <code>&lt;q&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a> in the way similar to <code>grep -A</code> / <code>grep -B</code>.\nThe returned log chunks are delimited with <code>---</code> <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\">log message</a> for easier investigation.</p>\n<p>For example, the following query returns up to 10 additional logs after every log message with the <code>panic</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#word\">word</a> across all the logs for the last 5 minutes:</p>\n<pre><code class=\"language-logsql\">_time:5m panic | stream_context after 10\n</code></pre>\n<p>The following query returns up to 5 additional logs in front of every log message with the <code>stacktrace</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#word\">word</a> across all the logs for the last 5 minutes:</p>\n<pre><code class=\"language-logsql\">_time:5m stacktrace | stream_context before 5\n</code></pre>\n<p>The following query returns up to 2 logs in front of the log message with the <code>error</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#word\">word</a> and up to 5 logs after this log message\nacross all the logs for the last 5 minutes:</p>\n<pre><code class=\"language-logsql\">_time:5m error | stream_context before 2 after 5\n</code></pre>\n<p>By default <code>stream_context</code> pipe looks for surrounding logs in a one-hour window. This window can be changed via the <code>time_window</code> option at query time.\nFor example, the following query searches for surrounding logs in a one-week window:</p>\n<pre><code class=\"language-logsql\">_time:5m error | stream_context before 10 time_window 1w\n</code></pre>\n<p>The <code>| stream_context</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> must go first just after the <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#filters\">filters</a>.</p>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#stream-filter\">stream filter</a></li>\n</ul>\n</div>"
  },
  {
    "id": "time-add-pipe",
    "value": "time_add",
    "title": "time_add pipe",
    "description": "<div class='vm-markdown'><p><code>&lt;q&gt; | time_add &lt;duration&gt;</code> adds the given <code>&lt;duration&gt;</code> to the <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#time-field\"><code>_time</code> field</a>.\nThe <code>&lt;duration&gt;</code> can be in any format described <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#duration-values\">here</a>.</p>\n<p>For example, the following query adds one hour to <code>_time</code> field in the selected logs:</p>\n<pre><code class=\"language-logsql\">_time:5m | time_add 1h\n</code></pre>\n<p>Specify negative duration for subtracting it from the <code>_time</code> field:</p>\n<pre><code class=\"language-logsql\">_time:5m | time_add -1h\n</code></pre>\n<p>Add <code>at &lt;field_name&gt;</code> to the end of the <code>time_add</code> pipe in order to add the given <code>&lt;duration&gt;</code> to the <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">log field</a>\nwith the given <code>&lt;field_name&gt;</code>. For example, the following query adds one week to the field <code>transaction_time</code>:</p>\n<pre><code class=\"language-logsql\">_time:5m | time_add 1w at transaction_time\n</code></pre>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#time-filter\"><code>_time</code> filter</a>.</li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-options\"><code>time_offset</code> option</a>.</li>\n</ul>\n</div>"
  },
  {
    "id": "top-pipe",
    "value": "top",
    "title": "top pipe",
    "description": "<div class='vm-markdown'><p><code>&lt;q&gt; | top N by (field1, ..., fieldN)</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> returns top <code>N</code> sets for <code>(field1, ..., fieldN)</code> <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">log fields</a>\nwith the maximum number of matching log entries across logs returned by <code>&lt;q&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a>.</p>\n<p>For example, the following query returns top 7 <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#stream-fields\">log streams</a>\nwith the maximum number of log entries over the last 5 minutes. The number of entries is returned in the <code>hits</code> field:</p>\n<pre><code class=\"language-logsql\">_time:5m | top 7 by (_stream)\n</code></pre>\n<p>The <code>N</code> is optional. If it is skipped, then top 10 entries are returned. For example, the following query returns top 10 values\nfor <code>ip</code> <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">field</a> seen in logs for the last 5 minutes:</p>\n<pre><code class=\"language-logsql\">_time:5m | top by (ip)\n</code></pre>\n<p>It is possible to give another name for the <code>hits</code> field via <code>hits as &lt;new_name&gt;</code> syntax. For example, the following query returns top per-<code>path</code> hits in the <code>visits</code> field:</p>\n<pre><code class=\"language-logsql\">_time:5m | top by (path) hits as visits\n</code></pre>\n<p>It is possible to set a <code>rank</code> field for each returned entry for the <code>top</code> pipe by adding <code>rank</code>. For example, the following query sets the <code>rank</code> field for each returned <code>ip</code>:</p>\n<pre><code class=\"language-logsql\">_time:5m | top 10 by (ip) rank\n</code></pre>\n<p>The <code>rank</code> field can have other name. For example, the following query uses the <code>position</code> field name instead of <code>rank</code> field name in the output:</p>\n<pre><code class=\"language-logsql\">_time:5m | top 10 by (ip) rank as position\n</code></pre>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#first-pipe\"><code>first</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#last-pipe\"><code>last</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#facets-pipe\"><code>facets</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#uniq-pipe\"><code>uniq</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#stats-pipe\"><code>stats</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#sort-pipe\"><code>sort</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#histogram-stats\"><code>histogram</code> stats function</a></li>\n</ul>\n</div>"
  },
  {
    "id": "total-stats-pipe",
    "value": "total_stats",
    "title": "total_stats pipe",
    "description": "<div class='vm-markdown'><p>The <code>&lt;q&gt; | total_stats ...</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> calculates total (global) stats (such as <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#count-total_stats\">global count</a> or <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#sum-total_stats\">global sum</a>)\nover the specified <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">log fields</a> returned by <code>&lt;q&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a>\nand stores these stats in the specified log fields for each input log entry.</p>\n<p>The total stats is calculated over the logs sorted by time, so the <code>&lt;q&gt;</code> must return the <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#time-field\"><code>_time</code> field</a>\nin order to properly calculate the total stats.</p>\n<p>The <code>total_stats</code> pipe puts all the logs returned by <code>&lt;q&gt;</code> in memory, so make sure the <code>&lt;q&gt;</code> returns the limited number of logs in order to avoid high memory usage.</p>\n<p>For example, the following LogsQL query calculates <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#sum-total_stats\">total sum</a> for the <code>hits</code> field over the logs for the last 5 minutes:</p>\n<pre><code class=\"language-logsql\">_time:5m | total_stats sum(hits) as total_hits\n</code></pre>\n<p>The <code>| total_stats ...</code> pipe has the following basic format:</p>\n<pre><code class=\"language-logsql\">... | total_stats\n  stats_func1(...) as result_name1,\n  ...\n  stats_funcN(...) as result_nameN\n</code></pre>\n<p>Where <code>stats_func*</code> is any of the supported <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#total_stats-pipe-functions\">total stats function</a>, while the <code>result_name*</code> is the name of the log field\nto store the result of the corresponding stats function. The <code>as</code> keyword is optional.</p>\n<p>For example, the following query calculates the following total stats for logs over the last 5 minutes:</p>\n<ul>\n<li>the number of logs with the help of <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#count-total_stats\"><code>count</code> function</a>;</li>\n<li>the sum of <code>hits</code> field with the help of <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#sum-total_stats\"><code>sum</code> function</a>:</li>\n</ul>\n<pre><code class=\"language-logsql\">_time:5m\n    | total_stats\n        count() as total_logs,\n        sum(hits) as total_hits\n</code></pre>\n<p>It is allowed omitting the result name. In this case the result name equals the string representation of the used <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#total_stats-pipe-functions\">total stats function</a>.\nFor example, the following query returns the same stats as the previous one, but gives <code>count()</code> and <code>sum(hits)</code> names for the returned fields:</p>\n<pre><code class=\"language-logsql\">_time:5m | total_stats count(), sum(hits)\n</code></pre>\n<p>It is useful to combine <code>total_stats</code> with <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#stats-by-time-buckets\">stats by time buckets</a>. For example, the following query returns per-hour number of logs over the last day,\nplus the total number of logs, and then calculates the per-hour percent of hits over the daily hits.</p>\n<pre><code class=\"language-logsql\">_time:1d\n    | stats by (_time:hour) count() as hits\n    | total_stats sum(hits) as total_hits\n    | math round((hits / total_hits)*100) as hits_percent\n</code></pre>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#total_stats-pipe-functions\"><code>total_stats</code> pipe functions</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#total_stats-by-fields\"><code>total_stats</code> by fields</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#running_stats-pipe\"><code>running_stats</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#stats-pipe\"><code>stats</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#sort-pipe\"><code>sort</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "union-pipe",
    "value": "union",
    "title": "union pipe",
    "description": "<div class='vm-markdown'><p><code>&lt;q1&gt; | union (&lt;q2&gt;)</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> returns results of <code>&lt;q1&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a> followed by results of <code>&lt;q2&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a>.\nIt works similarly to <code>UNION ALL</code> in SQL. <code>&lt;q1&gt;</code> and <code>q2</code> may contain arbitrary <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#logsql-tutorial\">LogsQL queries</a>.\nFor example, the following query returns logs with <code>error</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#word\">word</a> for the last 5 minutes, plus logs with <code>panic</code> word for the last hour:</p>\n<pre><code class=\"language-logsql\">_time:5m error | union (_time:1h panic)\n</code></pre>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#join-pipe\"><code>join</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#subquery-filter\">subquery filter</a></li>\n</ul>\n</div>"
  },
  {
    "id": "uniq-pipe",
    "value": "uniq",
    "title": "uniq pipe",
    "description": "<div class='vm-markdown'><p><code>&lt;q&gt; | uniq by (field1, ..., fieldN)</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> returns unique values for the given <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">log fields</a>\nover the logs returned by <code>&lt;q&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a>. For example, the following LogsQL query\nreturns unique values for <code>ip</code> <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">log field</a>\nover logs for the last 5 minutes:</p>\n<pre><code class=\"language-logsql\">_time:5m | uniq by (ip)\n</code></pre>\n<p>It is possible to specify multiple fields inside <code>by(...)</code> clause. In this case all the unique sets for the given fields\nare returned. For example, the following query returns all the unique <code>(host, path)</code> pairs for the logs over the last 5 minutes:</p>\n<pre><code class=\"language-logsql\">_time:5m | uniq by (host, path)\n</code></pre>\n<p>The unique entries are returned in arbitrary order. Use <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#sort-pipe\"><code>sort</code> pipe</a> in order to sort them if needed.</p>\n<p>Add <code>with hits</code> after <code>uniq by (...)</code> in order to return the number of matching logs for each field value:</p>\n<pre><code class=\"language-logsql\">_time:5m | uniq by (host) with hits\n</code></pre>\n<p>Unique entries are stored in memory during query execution. Big number of unique selected entries may require a lot of memory.\nSometimes it is enough to return up to <code>N</code> unique entries. This can be done by adding <code>limit N</code> after <code>by (...)</code> clause.\nThis allows limiting memory usage. For example, the following query returns up to 100 unique <code>(host, path)</code> pairs for the logs over the last 5 minutes:</p>\n<pre><code class=\"language-logsql\">_time:5m | uniq by (host, path) limit 100\n</code></pre>\n<p>If the <code>limit</code> is reached, then arbitrary subset of unique values can be returned. The <code>hits</code> calculation doesn&#39;t work when the <code>limit</code> is reached.</p>\n<p>The <code>by</code> keyword can be skipped in <code>uniq ...</code> pipe. For example, the following query is equivalent to the previous one:</p>\n<pre><code class=\"language-logsql\">_time:5m | uniq (host, path) limit 100\n</code></pre>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#uniq_values-stats\"><code>uniq_values</code> stats function</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#top-pipe\"><code>top</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#stats-pipe\"><code>stats</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "unpack-json-pipe",
    "value": "unpack_json",
    "title": "unpack_json pipe",
    "description": "<div class='vm-markdown'><p><code>&lt;q&gt; | unpack_json from field_name</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> unpacks <code>{&quot;k1&quot;:&quot;v1&quot;, ..., &quot;kN&quot;:&quot;vN&quot;}</code> JSON from the given <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\"><code>field_name</code></a>\nof <code>&lt;q&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a> results into <code>k1</code>, ... <code>kN</code> output field names with the corresponding <code>v1</code>, ..., <code>vN</code> values.\nIt overrides existing fields with names from the <code>k1</code>, ..., <code>kN</code> list. Other fields remain untouched.</p>\n<p>Nested JSON is unpacked according to the rules defined <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">here</a>.</p>\n<p>For example, the following query unpacks JSON fields from the <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\"><code>_msg</code> field</a> across logs for the last 5 minutes:</p>\n<pre><code class=\"language-logsql\">_time:5m | unpack_json from _msg\n</code></pre>\n<p>The <code>from _msg</code> part can be omitted when JSON fields are unpacked from the <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\"><code>_msg</code> field</a>.\nThe following query is equivalent to the previous one:</p>\n<pre><code class=\"language-logsql\">_time:5m | unpack_json\n</code></pre>\n<p>If only some fields must be extracted from JSON, then they can be enumerated inside <code>fields (...)</code>. For example, the following query unpacks only <code>foo</code> and <code>bar</code>\nfields from JSON value stored in <code>my_json</code> <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">log field</a>:</p>\n<pre><code class=\"language-logsql\">_time:5m | unpack_json from my_json fields (foo, bar)\n</code></pre>\n<p>If it is needed to extract all the fields with some common prefix, then this can be done via <code>fields(prefix*)</code> syntax.</p>\n<p>If it is needed to preserve the original non-empty field values, then add <code>keep_original_fields</code> to the end of <code>unpack_json ...</code>. For example,\nthe following query preserves the original non-empty values for <code>ip</code> and <code>host</code> fields instead of overwriting them with the unpacked values:</p>\n<pre><code class=\"language-logsql\">_time:5m | unpack_json from foo fields (ip, host) keep_original_fields\n</code></pre>\n<p>Add <code>skip_empty_results</code> to the end of <code>unpack_json ...</code> if the original field values must be preserved when the corresponding unpacked values are empty.\nFor example, the following query preserves the original <code>ip</code> and <code>host</code> field values for empty unpacked values:</p>\n<pre><code class=\"language-logsql\">_time:5m | unpack_json fields (ip, host) skip_empty_results\n</code></pre>\n<p>Performance tip: if you need to extract a single field from long JSON, it is faster to use the <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#extract-pipe\"><code>extract</code> pipe</a>. For example, the following query extracts the <code>&quot;ip&quot;</code> field from JSON\nstored in <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\"><code>_msg</code> field</a> at the maximum speed:</p>\n<pre><code>_time:5m | extract &#39;&quot;ip&quot;:&lt;ip&gt;&#39;\n</code></pre>\n<p>If you want to make sure that the unpacked JSON fields do not clash with the existing fields, then specify common prefix for all the fields extracted from JSON,\nby adding <code>result_prefix &quot;prefix_name&quot;</code> to <code>unpack_json</code>. For example, the following query adds the <code>foo_</code> prefix for all the unpacked fields\nfrom <code>foo</code>:</p>\n<pre><code class=\"language-logsql\">_time:5m | unpack_json from foo result_prefix &quot;foo_&quot;\n</code></pre>\n<p>Performance tips:</p>\n<ul>\n<li><p>It is better from performance and resource usage PoV ingesting parsed JSON logs into VictoriaLogs\naccording to the <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">supported data model</a>\ninstead of ingesting unparsed JSON lines into VictoriaLogs and then parsing them at query time with <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#unpack_json-pipe\"><code>unpack_json</code> pipe</a>.</p>\n</li>\n<li><p>It is recommended to use more specific <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#filters\">log filters</a> in order to reduce the number of log entries that are passed to <code>unpack_json</code>.\nSee <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#performance-tips\">general performance tips</a> for details.</p>\n</li>\n</ul>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#conditional-unpack_json\">Conditional <code>unpack_json</code></a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#unpack_logfmt-pipe\"><code>unpack_logfmt</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#unpack_syslog-pipe\"><code>unpack_syslog</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#extract-pipe\"><code>extract</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#split-pipe\"><code>split</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#unroll-pipe\"><code>unroll</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pack_json-pipe\"><code>pack_json</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pack_logfmt-pipe\"><code>pack_logfmt</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "unpack-logfmt-pipe",
    "value": "unpack_logfmt",
    "title": "unpack_logfmt pipe",
    "description": "<div class='vm-markdown'><p><code>&lt;q&gt; | unpack_logfmt from field_name</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> unpacks <code>k1=v1 ... kN=vN</code> <a href=\"https://brandur.org/logfmt\">logfmt</a> fields\nfrom the given <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\"><code>field_name</code></a> of <code>&lt;q&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a> results into <code>k1</code>, ... <code>kN</code> field names\nwith the corresponding <code>v1</code>, ..., <code>vN</code> values. It overrides existing fields with names from the <code>k1</code>, ..., <code>kN</code> list. Other fields remain untouched.</p>\n<p>For example, the following query unpacks <a href=\"https://brandur.org/logfmt\">logfmt</a> fields from the <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\"><code>_msg</code> field</a>\nacross logs for the last 5 minutes:</p>\n<pre><code class=\"language-logsql\">_time:5m | unpack_logfmt from _msg\n</code></pre>\n<p>The <code>from _msg</code> part can be omitted when <a href=\"https://brandur.org/logfmt\">logfmt</a> fields are unpacked from the <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\"><code>_msg</code> field</a>.\nThe following query is equivalent to the previous one:</p>\n<pre><code class=\"language-logsql\">_time:5m | unpack_logfmt\n</code></pre>\n<p>If only some fields must be unpacked from logfmt, then they can be enumerated inside <code>fields (...)</code>. For example, the following query extracts only <code>foo</code> and <code>bar</code> fields\nfrom logfmt stored in the <code>my_logfmt</code> field:</p>\n<pre><code class=\"language-logsql\">_time:5m | unpack_logfmt from my_logfmt fields (foo, bar)\n</code></pre>\n<p>If it is needed to extract all the fields with some common prefix, then this can be done via <code>fields(prefix*)</code> syntax.</p>\n<p>If it is needed to preserve the original non-empty field values, then add <code>keep_original_fields</code> to the end of <code>unpack_logfmt ...</code>. For example,\nthe following query preserves the original non-empty values for <code>ip</code> and <code>host</code> fields instead of overwriting them with the unpacked values:</p>\n<pre><code class=\"language-logsql\">_time:5m | unpack_logfmt from foo fields (ip, host) keep_original_fields\n</code></pre>\n<p>Add <code>skip_empty_results</code> to the end of <code>unpack_logfmt ...</code> if the original field values must be preserved when the corresponding unpacked values are empty.\nFor example, the following query preserves the original <code>ip</code> and <code>host</code> field values for empty unpacked values:</p>\n<pre><code class=\"language-logsql\">_time:5m | unpack_logfmt fields (ip, host) skip_empty_results\n</code></pre>\n<p>Performance tip: if you need to extract a single field from a long <a href=\"https://brandur.org/logfmt\">logfmt</a> line, it is faster to use the <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#extract-pipe\"><code>extract</code> pipe</a>.\nFor example, the following query extracts <code>&quot;ip&quot;</code> field from <a href=\"https://brandur.org/logfmt\">logfmt</a> line stored\nin <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\"><code>_msg</code> field</a>:</p>\n<pre><code>_time:5m | extract &#39; ip=&lt;ip&gt;&#39;\n</code></pre>\n<p>If you want to make sure that the unpacked <a href=\"https://brandur.org/logfmt\">logfmt</a> fields do not clash with the existing fields, then specify common prefix for all the fields extracted from logfmt,\nby adding <code>result_prefix &quot;prefix_name&quot;</code> to <code>unpack_logfmt</code>. For example, the following query adds <code>foo_</code> prefix for all the unpacked fields\nfrom <code>foo</code> field:</p>\n<pre><code class=\"language-logsql\">_time:5m | unpack_logfmt from foo result_prefix &quot;foo_&quot;\n</code></pre>\n<p>Performance tips:</p>\n<ul>\n<li><p>It is better from performance and resource usage PoV ingesting parsed <a href=\"https://brandur.org/logfmt\">logfmt</a> logs into VictoriaLogs\naccording to the <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">supported data model</a>\ninstead of ingesting unparsed logfmt lines into VictoriaLogs and then parsing them at query time with <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#unpack_logfmt-pipe\"><code>unpack_logfmt</code> pipe</a>.</p>\n</li>\n<li><p>It is recommended to use more specific <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#filters\">log filters</a> in order to reduce the number of log entries that are passed to <code>unpack_logfmt</code>.\nSee <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#performance-tips\">general performance tips</a> for details.</p>\n</li>\n</ul>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#conditional-unpack_logfmt\">Conditional unpack_logfmt</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#unpack_json-pipe\"><code>unpack_json</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#unpack_syslog-pipe\"><code>unpack_syslog</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#extract-pipe\"><code>extract</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "unpack-syslog-pipe",
    "value": "unpack_syslog",
    "title": "unpack_syslog pipe",
    "description": "<div class='vm-markdown'><p><code>&lt;q&gt; | unpack_syslog from field_name</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> unpacks <a href=\"https://en.wikipedia.org/wiki/Syslog\">syslog</a> message\nfrom the given <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\"><code>field_name</code></a> of <code>&lt;q&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a> results.\nIt understands the following Syslog formats:</p>\n<ul>\n<li><a href=\"https://datatracker.ietf.org/doc/html/rfc3164\">RFC3164</a> aka <code>&lt;PRI&gt;MMM DD hh:mm:ss HOSTNAME APP-NAME[PROCID]: MESSAGE</code></li>\n<li><a href=\"https://datatracker.ietf.org/doc/html/rfc5424\">RFC5424</a> aka <code>&lt;PRI&gt;1 TIMESTAMP HOSTNAME APP-NAME PROCID MSGID [STRUCTURED-DATA] MESSAGE</code></li>\n</ul>\n<p>The following fields are unpacked:</p>\n<ul>\n<li><code>level</code> - obtained from <code>PRI</code>.</li>\n<li><code>priority</code> - obtained from <code>PRI</code>.</li>\n<li><code>facility</code> - calculated as <code>PRI / 8</code>.</li>\n<li><code>facility_keyword</code> - string representation of the <code>facility</code> field according to <a href=\"https://en.wikipedia.org/wiki/Syslog#Facility\">these docs</a>.</li>\n<li><code>severity</code> - calculated as <code>PRI % 8</code>.</li>\n<li><code>format</code> - either <code>rfc3164</code> or <code>rfc5424</code> depending on which Syslog format is unpacked.</li>\n<li><code>timestamp</code> - timestamp in <a href=\"https://en.wikipedia.org/wiki/ISO_8601\">ISO8601 format</a>. The <code>MMM DD hh:mm:ss</code> timestamp in <a href=\"https://datatracker.ietf.org/doc/html/rfc3164\">RFC3164</a>\nis automatically converted into <a href=\"https://en.wikipedia.org/wiki/ISO_8601\">ISO8601 format</a> by assuming that the timestamp belongs to the last 12 months.</li>\n<li><code>hostname</code></li>\n<li><code>app_name</code></li>\n<li><code>proc_id</code></li>\n<li><code>msg_id</code></li>\n<li><code>message</code></li>\n</ul>\n<p>The <code>&lt;PRI&gt;</code> part is optional. If it is missing, then <code>priority</code>, <code>facility</code> and <code>severity</code> fields aren&#39;t set.</p>\n<p>The <code>[STRUCTURED-DATA]</code> is parsed into fields with the <code>SD-ID.param1</code>, <code>SD-ID.param2</code>, ..., <code>SD-ID.paramN</code> names and the corresponding values\naccording to <a href=\"https://datatracker.ietf.org/doc/html/rfc5424#section-6.3\">the specification</a>.</p>\n<p>If the <code>app_name</code> equals <code>CEF</code> and the <code>message</code> contains Common Event Format data for SIEM\naka <a href=\"https://www.microfocus.com/documentation/arcsight/arcsight-smartconnectors-8.3/cef-implementation-standard/Content/CEF/Chapter%201%20What%20is%20CEF.htm\">CEF for Syslog</a>,\nthen it is automatically parsed into the following fields:</p>\n<ul>\n<li><code>cef.version</code> - the CEF version</li>\n<li><code>cef.device_vendor</code> - the device vendor field</li>\n<li><code>cef.device_product</code> - the device product field</li>\n<li><code>cef.device_version</code> - the device version field</li>\n<li><code>cef.device_event_class_id</code> - the device event class id</li>\n<li><code>cef.name</code> - the CEF name</li>\n<li><code>cef.severity</code> - the severity field</li>\n</ul>\n<p>Optional extension fields are parsed into <code>cef.extension.&lt;key&gt;=&lt;value&gt;</code> fields.</p>\n<p>For example, the following query unpacks <a href=\"https://en.wikipedia.org/wiki/Syslog\">syslog</a> message from the <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\"><code>_msg</code> field</a>\nacross logs for the last 5 minutes:</p>\n<pre><code class=\"language-logsql\">_time:5m | unpack_syslog from _msg\n</code></pre>\n<p>The <code>from _msg</code> part can be omitted when <a href=\"https://en.wikipedia.org/wiki/Syslog\">syslog</a> message is unpacked\nfrom the <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\"><code>_msg</code> field</a>.\nThe following query is equivalent to the previous one:</p>\n<pre><code class=\"language-logsql\">_time:5m | unpack_syslog\n</code></pre>\n<p>By default timestamps in <a href=\"https://datatracker.ietf.org/doc/html/rfc3164\">RFC3164 format</a> are converted to local timezone. It is possible to change the timezone\noffset via <code>offset</code> option. For example, the following query adds 5 hours and 30 minutes to unpacked <code>rfc3164</code> timestamps:</p>\n<pre><code class=\"language-logsql\">_time:5m | unpack_syslog offset 5h30m\n</code></pre>\n<p>If it is needed to preserve the original non-empty field values, then add <code>keep_original_fields</code> to the end of <code>unpack_syslog ...</code>:</p>\n<pre><code class=\"language-logsql\">_time:5m | unpack_syslog keep_original_fields\n</code></pre>\n<p>If you want to make sure that the unpacked <a href=\"https://en.wikipedia.org/wiki/Syslog\">syslog</a> fields do not clash with the existing fields,\nthen specify common prefix for all the fields extracted from syslog, by adding <code>result_prefix &quot;prefix_name&quot;</code> to <code>unpack_syslog</code>.\nFor example, the following query adds <code>foo_</code> prefix for all the unpacked fields from <code>foo</code> field:</p>\n<pre><code class=\"language-logsql\">_time:5m | unpack_syslog from foo result_prefix &quot;foo_&quot;\n</code></pre>\n<p>Performance tips:</p>\n<ul>\n<li><p>It is better from performance and resource usage PoV ingesting parsed <a href=\"https://en.wikipedia.org/wiki/Syslog\">syslog</a> messages into VictoriaLogs\naccording to the <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">supported data model</a>\ninstead of ingesting unparsed syslog lines into VictoriaLogs and then parsing them at query time with <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#unpack_syslog-pipe\"><code>unpack_syslog</code> pipe</a>.</p>\n</li>\n<li><p>It is recommended to use more specific <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#filters\">log filters</a> in order to reduce the number of log entries that are passed to <code>unpack_syslog</code>.\nSee <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#performance-tips\">general performance tips</a> for details.</p>\n</li>\n</ul>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#conditional-unpack_syslog\">Conditional unpack_syslog</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#unpack_json-pipe\"><code>unpack_json</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#unpack_logfmt-pipe\"><code>unpack_logfmt</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#extract-pipe\"><code>extract</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "unpack-words-pipe",
    "value": "unpack_words",
    "title": "unpack_words pipe",
    "description": "<div class='vm-markdown'><p>The <code>&lt;q&gt; | unpack_words from &lt;src_field&gt; as &lt;dst_field&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> unpacks <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#word\">words</a> from the given\n<code>&lt;src_field&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">log field</a>\nof <code>&lt;q&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a> results into <code>&lt;dst_field&gt;</code> as a JSON array.</p>\n<p>For example, the following query unpacks words from <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\">log messages</a> into <code>words</code> field:</p>\n<pre><code class=\"language-logsql\">_time:5m | unpack_words from _msg as words\n</code></pre>\n<p>The <code>as &lt;dst_field&gt;</code> part is optional. If it is missing, then the result is stored in the <code>&lt;src_field&gt;</code> specified in <code>from &lt;src_field&gt;</code>.\nFor example, the following query stores the unpacked words into <code>_msg</code> field:</p>\n<pre><code class=\"language-logsql\">_time:5m | unpack_words from _msg\n</code></pre>\n<p>The <code>from &lt;src_field&gt;</code> part is optional. If it is missing, then words are unpacked from the <code>_msg</code> field. The following query is equivalent to the previous one:</p>\n<pre><code class=\"language-logsql\">_time:5m | unpack_words\n</code></pre>\n<p>By default <code>unpack_words</code> pipe unpacks all the words, including duplicates, from the <code>&lt;src_field&gt;</code>. It is possible to drop duplicate words by adding <code>drop_duplicates</code> suffix to the pipe.\nFor example, the following query extracts only unique words from every <code>text</code> field:</p>\n<pre><code class=\"language-logsql\">_time:5m | unpack_words from text as words drop_duplicates\n</code></pre>\n<p>It is convenient to use <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#unroll-pipe\"><code>unroll</code> pipe</a> for unrolling the JSON array with unpacked words from the destination field.\nFor example, the following query returns top 5 most frequently seen words across <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#message-field\">log messages</a> for the last 5 minutes:</p>\n<pre><code class=\"language-logsql\">_time:5m | unpack_words as words | unroll words | top 5 (words)\n</code></pre>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#unroll-pipe\"><code>unroll</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#split-pipe\"><code>split</code> pipe</a></li>\n</ul>\n</div>"
  },
  {
    "id": "unroll-pipe",
    "value": "unroll",
    "title": "unroll pipe",
    "description": "<div class='vm-markdown'><p><code>&lt;q&gt; | unroll by (field1, ..., fieldN)</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#pipes\">pipe</a> can be used for unrolling JSON arrays from <code>field1</code>, ..., <code>fieldN</code>\n<a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">log fields</a> of <code>&lt;q&gt;</code> <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#query-syntax\">query</a> results into separate rows.</p>\n<p>For example, the following query unrolls <code>timestamp</code> and <code>value</code> <a href=\"https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model\">log fields</a> from logs for the last 5 minutes:</p>\n<pre><code class=\"language-logsql\">_time:5m | unroll (timestamp, value)\n</code></pre>\n<p>If the unrolled JSON array contains JSON objects, then it may be handy to use <a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#unpack_json-pipe\"><code>unpack_json</code></a> for unpacking\nthe unrolled array items into separate fields for further processing.</p>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#unpack_json-pipe\"><code>unpack_json</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#unpack_words-pipe\"><code>unpack_words</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#extract-pipe\"><code>extract</code> pipe</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#uniq_values-stats\"><code>uniq_values</code> stats function</a></li>\n<li><a href=\"https://docs.victoriametrics.com/victorialogs/logsql/#values-stats\"><code>values</code> stats function</a></li>\n</ul>\n</div>"
  }
] as const;
